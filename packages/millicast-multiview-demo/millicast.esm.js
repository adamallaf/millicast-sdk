function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(e,t,r,n,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,c,"next",e)}function c(e){r(s,i,o,a,c,"throw",e)}a(void 0)}))}}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(a)throw i}}return o}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw o}}}}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function l(e){var t={exports:{}};return e(t,t.exports),t.exports}var d,f,p=function(e){return e&&e.Math==Math&&e},h=p("object"==typeof globalThis&&globalThis)||p("object"==typeof window&&window)||p("object"==typeof self&&self)||p("object"==typeof u&&u)||function(){return this}()||Function("return this")(),g=function(e){try{return!!e()}catch(e){return!0}},m=!g((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v=!g((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),y=Function.prototype.call,b=v?y.bind(y):function(){return y.apply(y,arguments)},w={}.propertyIsEnumerable,S=Object.getOwnPropertyDescriptor,C=S&&!w.call({1:2},1)?function(e){var t=S(this,e);return!!t&&t.enumerable}:w,x={f:C},E=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},I=Function.prototype,T=I.bind,R=I.call,P=v&&T.bind(R,R),A=v?function(e){return e&&P(e)}:function(e){return e&&function(){return R.apply(e,arguments)}},k=A({}.toString),O=A("".slice),L=function(e){return O(k(e),8,-1)},D=Object,M=A("".split),N=g((function(){return!D("z").propertyIsEnumerable(0)}))?function(e){return"String"==L(e)?M(e,""):D(e)}:D,j=function(e){return null==e},B=TypeError,_=function(e){if(j(e))throw B("Can't call method on "+e);return e},U=function(e){return N(_(e))},F="object"==typeof document&&document.all,V={all:F,IS_HTMLDDA:void 0===F&&void 0!==F},z=V.all,G=V.IS_HTMLDDA?function(e){return"function"==typeof e||e===z}:function(e){return"function"==typeof e},q=V.all,W=V.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:G(e)||e===q}:function(e){return"object"==typeof e?null!==e:G(e)},X=function(e){return G(e)?e:void 0},H=function(e,t){return arguments.length<2?X(h[e]):h[e]&&h[e][t]},Y=A({}.isPrototypeOf),J=H("navigator","userAgent")||"",K=h.process,Z=h.Deno,Q=K&&K.versions||Z&&Z.version,ee=Q&&Q.v8;ee&&(f=(d=ee.split("."))[0]>0&&d[0]<4?1:+(d[0]+d[1])),!f&&J&&(!(d=J.match(/Edge\/(\d+)/))||d[1]>=74)&&(d=J.match(/Chrome\/(\d+)/))&&(f=+d[1]);var te=f,re=!!Object.getOwnPropertySymbols&&!g((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&te&&te<41})),ne=re&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ie=Object,oe=ne?function(e){return"symbol"==typeof e}:function(e){var t=H("Symbol");return G(t)&&Y(t.prototype,ie(e))},se=String,ae=function(e){try{return se(e)}catch(e){return"Object"}},ce=TypeError,ue=function(e){if(G(e))return e;throw ce(ae(e)+" is not a function")},le=function(e,t){var r=e[t];return j(r)?void 0:ue(r)},de=TypeError,fe=Object.defineProperty,pe=function(e,t){try{fe(h,e,{value:t,configurable:!0,writable:!0})}catch(r){h[e]=t}return t},he=h["__core-js_shared__"]||pe("__core-js_shared__",{}),ge=l((function(e){(e.exports=function(e,t){return he[e]||(he[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.2",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),me=Object,ve=function(e){return me(_(e))},ye=A({}.hasOwnProperty),be=Object.hasOwn||function(e,t){return ye(ve(e),t)},we=0,Se=Math.random(),Ce=A(1..toString),xe=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ce(++we+Se,36)},Ee=ge("wks"),Ie=h.Symbol,Te=Ie&&Ie.for,Re=ne?Ie:Ie&&Ie.withoutSetter||xe,Pe=function(e){if(!be(Ee,e)||!re&&"string"!=typeof Ee[e]){var t="Symbol."+e;re&&be(Ie,e)?Ee[e]=Ie[e]:Ee[e]=ne&&Te?Te(t):Re(t)}return Ee[e]},Ae=TypeError,ke=Pe("toPrimitive"),Oe=function(e,t){if(!W(e)||oe(e))return e;var r,n=le(e,ke);if(n){if(void 0===t&&(t="default"),r=b(n,e,t),!W(r)||oe(r))return r;throw Ae("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&G(r=e.toString)&&!W(n=b(r,e)))return n;if(G(r=e.valueOf)&&!W(n=b(r,e)))return n;if("string"!==t&&G(r=e.toString)&&!W(n=b(r,e)))return n;throw de("Can't convert object to primitive value")}(e,t)},Le=function(e){var t=Oe(e,"string");return oe(t)?t:t+""},De=h.document,Me=W(De)&&W(De.createElement),Ne=function(e){return Me?De.createElement(e):{}},je=!m&&!g((function(){return 7!=Object.defineProperty(Ne("div"),"a",{get:function(){return 7}}).a})),Be=Object.getOwnPropertyDescriptor,_e={f:m?Be:function(e,t){if(e=U(e),t=Le(t),je)try{return Be(e,t)}catch(e){}if(be(e,t))return E(!b(x.f,e,t),e[t])}},Ue=m&&g((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Fe=String,Ve=TypeError,ze=function(e){if(W(e))return e;throw Ve(Fe(e)+" is not an object")},$e=TypeError,Ge=Object.defineProperty,qe=Object.getOwnPropertyDescriptor,We={f:m?Ue?function(e,t,r){if(ze(e),t=Le(t),ze(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var n=qe(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Ge(e,t,r)}:Ge:function(e,t,r){if(ze(e),t=Le(t),ze(r),je)try{return Ge(e,t,r)}catch(e){}if("get"in r||"set"in r)throw $e("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Xe=m?function(e,t,r){return We.f(e,t,E(1,r))}:function(e,t,r){return e[t]=r,e},He=Function.prototype,Ye=m&&Object.getOwnPropertyDescriptor,Je=be(He,"name"),Ke={EXISTS:Je,PROPER:Je&&"something"===function(){}.name,CONFIGURABLE:Je&&(!m||m&&Ye(He,"name").configurable)},Ze=A(Function.toString);G(he.inspectSource)||(he.inspectSource=function(e){return Ze(e)});var Qe,et,tt,rt=he.inspectSource,nt=h.WeakMap,it=G(nt)&&/native code/.test(String(nt)),ot=ge("keys"),st=function(e){return ot[e]||(ot[e]=xe(e))},at={},ct=h.TypeError,ut=h.WeakMap;if(it||he.state){var lt=he.state||(he.state=new ut),dt=A(lt.get),ft=A(lt.has),pt=A(lt.set);Qe=function(e,t){if(ft(lt,e))throw ct("Object already initialized");return t.facade=e,pt(lt,e,t),t},et=function(e){return dt(lt,e)||{}},tt=function(e){return ft(lt,e)}}else{var ht=st("state");at[ht]=!0,Qe=function(e,t){if(be(e,ht))throw ct("Object already initialized");return t.facade=e,Xe(e,ht,t),t},et=function(e){return be(e,ht)?e[ht]:{}},tt=function(e){return be(e,ht)}}var gt={set:Qe,get:et,has:tt,enforce:function(e){return tt(e)?et(e):Qe(e,{})},getterFor:function(e){return function(t){var r;if(!W(t)||(r=et(t)).type!==e)throw ct("Incompatible receiver, "+e+" required");return r}}},mt=l((function(e){var t=Ke.CONFIGURABLE,r=gt.enforce,n=gt.get,i=Object.defineProperty,o=m&&!g((function(){return 8!==i((function(){}),"length",{value:8}).length})),s=String(String).split("String"),a=e.exports=function(e,n,a){"Symbol("===String(n).slice(0,7)&&(n="["+String(n).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),a&&a.getter&&(n="get "+n),a&&a.setter&&(n="set "+n),(!be(e,"name")||t&&e.name!==n)&&(m?i(e,"name",{value:n,configurable:!0}):e.name=n),o&&a&&be(a,"arity")&&e.length!==a.arity&&i(e,"length",{value:a.arity});try{a&&be(a,"constructor")&&a.constructor?m&&i(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var c=r(e);return be(c,"source")||(c.source=s.join("string"==typeof n?n:"")),e};Function.prototype.toString=a((function(){return G(this)&&n(this).source||rt(this)}),"toString")})),vt=function(e,t,r,n){n||(n={});var i=n.enumerable,o=void 0!==n.name?n.name:t;if(G(r)&&mt(r,o,n),n.global)i?e[t]=r:pe(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(e){}i?e[t]=r:We.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},yt=Math.ceil,bt=Math.floor,wt=Math.trunc||function(e){var t=+e;return(t>0?bt:yt)(t)},St=function(e){var t=+e;return t!=t||0===t?0:wt(t)},Ct=Math.max,xt=Math.min,Et=function(e,t){var r=St(e);return r<0?Ct(r+t,0):xt(r,t)},It=Math.min,Tt=function(e){return e>0?It(St(e),9007199254740991):0},Rt=function(e){return Tt(e.length)},Pt=function(e){return function(t,r,n){var i,o=U(t),s=Rt(o),a=Et(n,s);if(e&&r!=r){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===r)return e||a||0;return!e&&-1}},At={includes:Pt(!0),indexOf:Pt(!1)},kt=At.indexOf,Ot=A([].push),Lt=function(e,t){var r,n=U(e),i=0,o=[];for(r in n)!be(at,r)&&be(n,r)&&Ot(o,r);for(;t.length>i;)be(n,r=t[i++])&&(~kt(o,r)||Ot(o,r));return o},Dt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Mt=Dt.concat("length","prototype"),Nt={f:Object.getOwnPropertyNames||function(e){return Lt(e,Mt)}},jt={f:Object.getOwnPropertySymbols},Bt=A([].concat),_t=H("Reflect","ownKeys")||function(e){var t=Nt.f(ze(e)),r=jt.f;return r?Bt(t,r(e)):t},Ut=function(e,t,r){for(var n=_t(t),i=We.f,o=_e.f,s=0;s<n.length;s++){var a=n[s];be(e,a)||r&&be(r,a)||i(e,a,o(t,a))}},Ft=/#|\.prototype\./,Vt=function(e,t){var r=$t[zt(e)];return r==qt||r!=Gt&&(G(t)?g(t):!!t)},zt=Vt.normalize=function(e){return String(e).replace(Ft,".").toLowerCase()},$t=Vt.data={},Gt=Vt.NATIVE="N",qt=Vt.POLYFILL="P",Wt=Vt,Xt=_e.f,Ht=function(e,t){var r,n,i,o,s,a=e.target,c=e.global,u=e.stat;if(r=c?h:u?h[a]||pe(a,{}):(h[a]||{}).prototype)for(n in t){if(o=t[n],i=e.dontCallGetSet?(s=Xt(r,n))&&s.value:r[n],!Wt(c?n:a+(u?".":"#")+n,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;Ut(o,i)}(e.sham||i&&i.sham)&&Xe(o,"sham",!0),vt(r,n,o,e)}},Yt=Array.isArray||function(e){return"Array"==L(e)},Jt=TypeError,Kt=function(e){if(e>9007199254740991)throw Jt("Maximum allowed index exceeded");return e},Zt=function(e,t,r){var n=Le(t);n in e?We.f(e,n,E(0,r)):e[n]=r},Qt={};Qt[Pe("toStringTag")]="z";var er="[object z]"===String(Qt),tr=Pe("toStringTag"),rr=Object,nr="Arguments"==L(function(){return arguments}()),ir=er?L:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=rr(e),tr))?r:nr?L(t):"Object"==(n=L(t))&&G(t.callee)?"Arguments":n},or=function(){},sr=[],ar=H("Reflect","construct"),cr=/^\s*(?:class|function)\b/,ur=A(cr.exec),lr=!cr.exec(or),dr=function(e){if(!G(e))return!1;try{return ar(or,sr,e),!0}catch(e){return!1}},fr=function(e){if(!G(e))return!1;switch(ir(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return lr||!!ur(cr,rt(e))}catch(e){return!0}};fr.sham=!0;var pr=!ar||g((function(){var e;return dr(dr.call)||!dr(Object)||!dr((function(){e=!0}))||e}))?fr:dr,hr=Pe("species"),gr=Array,mr=function(e,t){return new(function(e){var t;return Yt(e)&&(t=e.constructor,(pr(t)&&(t===gr||Yt(t.prototype))||W(t)&&null===(t=t[hr]))&&(t=void 0)),void 0===t?gr:t}(e))(0===t?0:t)},vr=Pe("species"),yr=function(e){return te>=51||!g((function(){var t=[];return(t.constructor={})[vr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},br=Pe("isConcatSpreadable"),wr=te>=51||!g((function(){var e=[];return e[br]=!1,e.concat()[0]!==e})),Sr=yr("concat"),Cr=function(e){if(!W(e))return!1;var t=e[br];return void 0!==t?!!t:Yt(e)};Ht({target:"Array",proto:!0,arity:1,forced:!wr||!Sr},{concat:function(e){var t,r,n,i,o,s=ve(this),a=mr(s,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(Cr(o=-1===t?s:arguments[t]))for(i=Rt(o),Kt(c+i),r=0;r<i;r++,c++)r in o&&Zt(a,c,o[r]);else Kt(c+1),Zt(a,c++,o);return a.length=c,a}});var xr=A([].slice),Er=yr("slice"),Ir=Pe("species"),Tr=Array,Rr=Math.max;Ht({target:"Array",proto:!0,forced:!Er},{slice:function(e,t){var r,n,i,o=U(this),s=Rt(o),a=Et(e,s),c=Et(void 0===t?s:t,s);if(Yt(o)&&(r=o.constructor,(pr(r)&&(r===Tr||Yt(r.prototype))||W(r)&&null===(r=r[Ir]))&&(r=void 0),r===Tr||void 0===r))return xr(o,a,c);for(n=new(void 0===r?Tr:r)(Rr(c-a,0)),i=0;a<c;a++,i++)a in o&&Zt(n,i,o[a]);return n.length=i,n}});var Pr=A(A.bind),Ar=function(e,t){return ue(e),void 0===t?e:v?Pr(e,t):function(){return e.apply(t,arguments)}},kr=A([].push),Or=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,d){for(var f,p,h=ve(c),g=N(h),m=Ar(u,l),v=Rt(g),y=0,b=d||mr,w=t?b(c,v):r||s?b(c,0):void 0;v>y;y++)if((a||y in g)&&(p=m(f=g[y],y,h),e))if(t)w[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:kr(w,f)}else switch(e){case 4:return!1;case 7:kr(w,f)}return o?-1:n||i?i:w}},Lr={forEach:Or(0),map:Or(1),filter:Or(2),some:Or(3),every:Or(4),find:Or(5),findIndex:Or(6),filterReject:Or(7)},Dr=Lr.map,Mr=yr("map");Ht({target:"Array",proto:!0,forced:!Mr},{map:function(e){return Dr(this,e,arguments.length>1?arguments[1]:void 0)}});var Nr=Function.prototype,jr=Nr.apply,Br=Nr.call,_r="object"==typeof Reflect&&Reflect.apply||(v?Br.bind(jr):function(){return Br.apply(jr,arguments)}),Ur=H("JSON","stringify"),Fr=A(/./.exec),Vr=A("".charAt),zr=A("".charCodeAt),$r=A("".replace),Gr=A(1..toString),qr=/[\uD800-\uDFFF]/g,Wr=/^[\uD800-\uDBFF]$/,Xr=/^[\uDC00-\uDFFF]$/,Hr=!re||g((function(){var e=H("Symbol")();return"[null]"!=Ur([e])||"{}"!=Ur({a:e})||"{}"!=Ur(Object(e))})),Yr=g((function(){return'"\\udf06\\ud834"'!==Ur("\udf06\ud834")||'"\\udead"'!==Ur("\udead")})),Jr=function(e,t){var r=xr(arguments),n=t;if((W(t)||void 0!==e)&&!oe(e))return Yt(t)||(t=function(e,t){if(G(n)&&(t=b(n,this,e,t)),!oe(t))return t}),r[1]=t,_r(Ur,null,r)},Kr=function(e,t,r){var n=Vr(r,t-1),i=Vr(r,t+1);return Fr(Wr,e)&&!Fr(Xr,i)||Fr(Xr,e)&&!Fr(Wr,n)?"\\u"+Gr(zr(e,0),16):e};Ur&&Ht({target:"JSON",stat:!0,arity:3,forced:Hr||Yr},{stringify:function(e,t,r){var n=xr(arguments),i=_r(Hr?Jr:Ur,null,n);return Yr&&"string"==typeof i?$r(i,qr,Kr):i}});var Zr=l((function(e){!function(t){var r,n={};n.VERSION="1.6.1";var i={},o=function(e,t){return function(){return t.apply(e,arguments)}},s=function(){var e,t,r=arguments,n=r[0];for(t=1;t<r.length;t++)for(e in r[t])!(e in n)&&r[t].hasOwnProperty(e)&&(n[e]=r[t][e]);return n},a=function(e,t){return{value:e,name:t}};n.TRACE=a(1,"TRACE"),n.DEBUG=a(2,"DEBUG"),n.INFO=a(3,"INFO"),n.TIME=a(4,"TIME"),n.WARN=a(5,"WARN"),n.ERROR=a(8,"ERROR"),n.OFF=a(99,"OFF");var c=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};c.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},trace:function(){this.invoke(n.TRACE,arguments)},debug:function(){this.invoke(n.DEBUG,arguments)},info:function(){this.invoke(n.INFO,arguments)},warn:function(){this.invoke(n.WARN,arguments)},error:function(){this.invoke(n.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(n.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(n.TIME,[e,"end"])},invoke:function(e,t){r&&this.enabledFor(e)&&r(t,s({level:e},this.context))}};var u,l=new c({filterLevel:n.OFF});(u=n).enabledFor=o(l,l.enabledFor),u.trace=o(l,l.trace),u.debug=o(l,l.debug),u.time=o(l,l.time),u.timeEnd=o(l,l.timeEnd),u.info=o(l,l.info),u.warn=o(l,l.warn),u.error=o(l,l.error),u.log=u.info,n.setHandler=function(e){r=e},n.setLevel=function(e){for(var t in l.setLevel(e),i)i.hasOwnProperty(t)&&i[t].setLevel(e)},n.getLevel=function(){return l.getLevel()},n.get=function(e){return i[e]||(i[e]=new c(s({name:e},l.context)))},n.createDefaultHandler=function(e){(e=e||{}).formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},r=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(i,o){i=Array.prototype.slice.call(i);var s,a=console.log;o.level===n.TIME?(s=(o.name?"["+o.name+"] ":"")+i[0],"start"===i[1]?console.time?console.time(s):t[s]=(new Date).getTime():console.timeEnd?console.timeEnd(s):r(a,[s+": "+((new Date).getTime()-t[s])+"ms"])):(o.level===n.WARN&&console.warn?a=console.warn:o.level===n.ERROR&&console.error?a=console.error:o.level===n.INFO&&console.info?a=console.info:o.level===n.DEBUG&&console.debug?a=console.debug:o.level===n.TRACE&&console.trace&&(a=console.trace),e.formatter(i,o),r(a,i))}},n.useDefaults=function(e){n.setLevel(e&&e.defaultLevel||n.DEBUG),n.setHandler(n.createDefaultHandler(e))},n.setDefaults=n.useDefaults,e.exports?e.exports=n:(n._prevLogger=t.Logger,n.noConflict=function(){return t.Logger=n._prevLogger,n},t.Logger=n)}(u)}));Zr.useDefaults({defaultLevel:Zr.TRACE});const Qr=(e,t)=>{e.unshift("[".concat(t.name||"Global","] ").concat((new Date).toISOString()," - ").concat(t.level.name," -"))},en=(e,t)=>t?e.value>=sn[t].value:e.value>=on.value,tn=Zr.createDefaultHandler({formatter:Qr});Zr.setHandler(((e,t)=>{((e,t)=>{e=(e=Array.prototype.slice.call(e)).map((e=>"object"==typeof e?JSON.stringify(e):e)),Qr(e,t),0!==rn?(nn.push(e.join(" ")),nn.length>=rn&&(nn=nn.slice(-rn))):nn=[]})(e,t),en(t.level,t.name)&&tn(e,t);var r,n=c(an);try{for(n.s();!(r=n.n()).done;){const n=r.value,i=n.handler,o=n.level;t.level.value>=o.value&&i(e,t)}}catch(e){n.e(e)}finally{n.f()}}));let rn=1e4,nn=[],on=Zr.OFF;const sn={},an=[],cn=t(t({},Zr),{},{enabledFor:en,getHistory:()=>nn,getHistoryMaxSize:()=>rn,setHistoryMaxSize:e=>{rn=e},setLevel:e=>{on=e;for(const t in sn)sn[t]=e},getLevel:()=>on,get:e=>{sn[e]||(sn[e]=on);const t=Zr.get(e);return t.setLevel=t=>{sn[e]=t},t.getLevel=()=>sn[e],t},setHandler:(e,t)=>{an.push({handler:e,level:t})}});var un,ln,dn,fn,pn="process"==L(h.process),hn=String,gn=TypeError,mn=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=A(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return ze(r),function(e){if("object"==typeof e||G(e))return e;throw gn("Can't set "+hn(e)+" as a prototype")}(n),t?e(r,n):r.__proto__=n,r}}():void 0),vn=We.f,yn=Pe("toStringTag"),bn=function(e,t,r){e&&!r&&(e=e.prototype),e&&!be(e,yn)&&vn(e,yn,{configurable:!0,value:t})},wn=Pe("species"),Sn=function(e){var t=H(e),r=We.f;m&&t&&!t[wn]&&r(t,wn,{configurable:!0,get:function(){return this}})},Cn=TypeError,xn=function(e,t){if(Y(t,e))return e;throw Cn("Incorrect invocation")},En=TypeError,In=Pe("species"),Tn=function(e,t){var r,n=ze(e).constructor;return void 0===n||j(r=ze(n)[In])?t:function(e){if(pr(e))return e;throw En(ae(e)+" is not a constructor")}(r)},Rn=H("document","documentElement"),Pn=TypeError,An=function(e,t){if(e<t)throw Pn("Not enough arguments");return e},kn=/(?:ipad|iphone|ipod).*applewebkit/i.test(J),On=h.setImmediate,Ln=h.clearImmediate,Dn=h.process,Mn=h.Dispatch,Nn=h.Function,jn=h.MessageChannel,Bn=h.String,_n=0,Un={};try{un=h.location}catch(e){}var Fn=function(e){if(be(Un,e)){var t=Un[e];delete Un[e],t()}},Vn=function(e){return function(){Fn(e)}},zn=function(e){Fn(e.data)},$n=function(e){h.postMessage(Bn(e),un.protocol+"//"+un.host)};On&&Ln||(On=function(e){An(arguments.length,1);var t=G(e)?e:Nn(e),r=xr(arguments,1);return Un[++_n]=function(){_r(t,void 0,r)},ln(_n),_n},Ln=function(e){delete Un[e]},pn?ln=function(e){Dn.nextTick(Vn(e))}:Mn&&Mn.now?ln=function(e){Mn.now(Vn(e))}:jn&&!kn?(fn=(dn=new jn).port2,dn.port1.onmessage=zn,ln=Ar(fn.postMessage,fn)):h.addEventListener&&G(h.postMessage)&&!h.importScripts&&un&&"file:"!==un.protocol&&!g($n)?(ln=$n,h.addEventListener("message",zn,!1)):ln="onreadystatechange"in Ne("script")?function(e){Rn.appendChild(Ne("script")).onreadystatechange=function(){Rn.removeChild(this),Fn(e)}}:function(e){setTimeout(Vn(e),0)});var Gn,qn,Wn,Xn,Hn,Yn,Jn,Kn,Zn={set:On,clear:Ln},Qn=/ipad|iphone|ipod/i.test(J)&&void 0!==h.Pebble,ei=/web0s(?!.*chrome)/i.test(J),ti=_e.f,ri=Zn.set,ni=h.MutationObserver||h.WebKitMutationObserver,ii=h.document,oi=h.process,si=h.Promise,ai=ti(h,"queueMicrotask"),ci=ai&&ai.value;ci||(Gn=function(){var e,t;for(pn&&(e=oi.domain)&&e.exit();qn;){t=qn.fn,qn=qn.next;try{t()}catch(e){throw qn?Xn():Wn=void 0,e}}Wn=void 0,e&&e.enter()},kn||pn||ei||!ni||!ii?!Qn&&si&&si.resolve?((Jn=si.resolve(void 0)).constructor=si,Kn=Ar(Jn.then,Jn),Xn=function(){Kn(Gn)}):pn?Xn=function(){oi.nextTick(Gn)}:(ri=Ar(ri,h),Xn=function(){ri(Gn)}):(Hn=!0,Yn=ii.createTextNode(""),new ni(Gn).observe(Yn,{characterData:!0}),Xn=function(){Yn.data=Hn=!Hn}));var ui=ci||function(e){var t={fn:e,next:void 0};Wn&&(Wn.next=t),qn||(qn=t,Xn()),Wn=t},li=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},di=function(){this.head=null,this.tail=null};di.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var fi=di,pi=h.Promise,hi="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,gi=!hi&&!pn&&"object"==typeof window&&"object"==typeof document;pi&&pi.prototype;var mi,vi,yi,bi=Pe("species"),wi=!1,Si=G(h.PromiseRejectionEvent),Ci=Wt("Promise",(function(){var e=rt(pi),t=e!==String(pi);if(!t&&66===te)return!0;if(!te||te<51||!/native code/.test(e)){var r=new pi((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[bi]=n,!(wi=r.then((function(){}))instanceof n))return!0}return!t&&(gi||hi)&&!Si})),xi={CONSTRUCTOR:Ci,REJECTION_EVENT:Si,SUBCLASSING:wi},Ei=TypeError,Ii=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw Ei("Bad Promise constructor");t=e,r=n})),this.resolve=ue(t),this.reject=ue(r)},Ti={f:function(e){return new Ii(e)}},Ri=Zn.set,Pi=xi.CONSTRUCTOR,Ai=xi.REJECTION_EVENT,ki=xi.SUBCLASSING,Oi=gt.getterFor("Promise"),Li=gt.set,Di=pi&&pi.prototype,Mi=pi,Ni=Di,ji=h.TypeError,Bi=h.document,_i=h.process,Ui=Ti.f,Fi=Ui,Vi=!!(Bi&&Bi.createEvent&&h.dispatchEvent),zi=function(e){var t;return!(!W(e)||!G(t=e.then))&&t},$i=function(e,t){var r,n,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&Hi(t),t.rejection=1),!0===a?r=o:(l&&l.enter(),r=a(o),l&&(l.exit(),i=!0)),r===e.promise?u(ji("Promise-chain cycle")):(n=zi(r))?b(n,r,c,u):c(r)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},Gi=function(e,t){e.notified||(e.notified=!0,ui((function(){for(var r,n=e.reactions;r=n.get();)$i(r,e);e.notified=!1,t&&!e.rejection&&Wi(e)})))},qi=function(e,t,r){var n,i;Vi?((n=Bi.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),h.dispatchEvent(n)):n={promise:t,reason:r},!Ai&&(i=h["on"+e])?i(n):"unhandledrejection"===e&&function(e,t){var r=h.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},Wi=function(e){b(Ri,h,(function(){var t,r=e.facade,n=e.value;if(Xi(e)&&(t=li((function(){pn?_i.emit("unhandledRejection",n,r):qi("unhandledrejection",r,n)})),e.rejection=pn||Xi(e)?2:1,t.error))throw t.value}))},Xi=function(e){return 1!==e.rejection&&!e.parent},Hi=function(e){b(Ri,h,(function(){var t=e.facade;pn?_i.emit("rejectionHandled",t):qi("rejectionhandled",t,e.value)}))},Yi=function(e,t,r){return function(n){e(t,n,r)}},Ji=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Gi(e,!0))},Ki=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw ji("Promise can't be resolved itself");var n=zi(t);n?ui((function(){var r={done:!1};try{b(n,t,Yi(Ki,r,e),Yi(Ji,r,e))}catch(t){Ji(r,t,e)}})):(e.value=t,e.state=1,Gi(e,!1))}catch(t){Ji({done:!1},t,e)}}};if(Pi&&(Ni=(Mi=function(e){xn(this,Ni),ue(e),b(mi,this);var t=Oi(this);try{e(Yi(Ki,t),Yi(Ji,t))}catch(e){Ji(t,e)}}).prototype,(mi=function(e){Li(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new fi,rejection:!1,state:0,value:void 0})}).prototype=vt(Ni,"then",(function(e,t){var r=Oi(this),n=Ui(Tn(this,Mi));return r.parent=!0,n.ok=!G(e)||e,n.fail=G(t)&&t,n.domain=pn?_i.domain:void 0,0==r.state?r.reactions.add(n):ui((function(){$i(n,r)})),n.promise})),vi=function(){var e=new mi,t=Oi(e);this.promise=e,this.resolve=Yi(Ki,t),this.reject=Yi(Ji,t)},Ti.f=Ui=function(e){return e===Mi||undefined===e?new vi(e):Fi(e)},G(pi)&&Di!==Object.prototype)){yi=Di.then,ki||vt(Di,"then",(function(e,t){var r=this;return new Mi((function(e,t){b(yi,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete Di.constructor}catch(e){}mn&&mn(Di,Ni)}Ht({global:!0,constructor:!0,wrap:!0,forced:Pi},{Promise:Mi}),bn(Mi,"Promise",!1),Sn("Promise");var Zi={},Qi=Pe("iterator"),eo=Array.prototype,to=function(e){return void 0!==e&&(Zi.Array===e||eo[Qi]===e)},ro=Pe("iterator"),no=function(e){if(!j(e))return le(e,ro)||le(e,"@@iterator")||Zi[ir(e)]},io=TypeError,oo=function(e,t){var r=arguments.length<2?no(e):t;if(ue(r))return ze(b(r,e));throw io(ae(e)+" is not iterable")},so=function(e,t,r){var n,i;ze(e);try{if(!(n=le(e,"return"))){if("throw"===t)throw r;return r}n=b(n,e)}catch(e){i=!0,n=e}if("throw"===t)throw r;if(i)throw n;return ze(n),r},ao=TypeError,co=function(e,t){this.stopped=e,this.result=t},uo=co.prototype,lo=function(e,t,r){var n,i,o,s,a,c,u,l=r&&r.that,d=!(!r||!r.AS_ENTRIES),f=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),g=Ar(t,l),m=function(e){return n&&so(n,"normal",e),new co(!0,e)},v=function(e){return d?(ze(e),h?g(e[0],e[1],m):g(e[0],e[1])):h?g(e,m):g(e)};if(f)n=e.iterator;else if(p)n=e;else{if(!(i=no(e)))throw ao(ae(e)+" is not iterable");if(to(i)){for(o=0,s=Rt(e);s>o;o++)if((a=v(e[o]))&&Y(uo,a))return a;return new co(!1)}n=oo(e,i)}for(c=f?e.next:n.next;!(u=b(c,n)).done;){try{a=v(u.value)}catch(e){so(n,"throw",e)}if("object"==typeof a&&a&&Y(uo,a))return a}return new co(!1)},fo=Pe("iterator"),po=!1;try{var ho=0,go={next:function(){return{done:!!ho++}},return:function(){po=!0}};go[fo]=function(){return this},Array.from(go,(function(){throw 2}))}catch(e){}var mo=function(e,t){if(!t&&!po)return!1;var r=!1;try{var n={};n[fo]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},vo=xi.CONSTRUCTOR||!mo((function(e){pi.all(e).then(void 0,(function(){}))}));Ht({target:"Promise",stat:!0,forced:vo},{all:function(e){var t=this,r=Ti.f(t),n=r.resolve,i=r.reject,o=li((function(){var r=ue(t.resolve),o=[],s=0,a=1;lo(e,(function(e){var c=s++,u=!1;a++,b(r,t,e).then((function(e){u||(u=!0,o[c]=e,--a||n(o))}),i)})),--a||n(o)}));return o.error&&i(o.value),r.promise}});var yo=xi.CONSTRUCTOR,bo=pi&&pi.prototype;if(Ht({target:"Promise",proto:!0,forced:yo,real:!0},{catch:function(e){return this.then(void 0,e)}}),G(pi)){var wo=H("Promise").prototype.catch;bo.catch!==wo&&vt(bo,"catch",wo,{unsafe:!0})}Ht({target:"Promise",stat:!0,forced:vo},{race:function(e){var t=this,r=Ti.f(t),n=r.reject,i=li((function(){var i=ue(t.resolve);lo(e,(function(e){b(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}}),Ht({target:"Promise",stat:!0,forced:xi.CONSTRUCTOR},{reject:function(e){var t=Ti.f(this);return b(t.reject,void 0,e),t.promise}});var So=xi.CONSTRUCTOR;H("Promise"),Ht({target:"Promise",stat:!0,forced:So},{resolve:function(e){return function(e,t){if(ze(e),W(t)&&t.constructor===e)return t;var r=Ti.f(e);return(0,r.resolve)(t),r.promise}(this,e)}});var Co=We.f,xo=function(e,t,r){r in e||Co(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},Eo=function(e,t,r){var n,i;return mn&&G(n=t.constructor)&&n!==r&&W(i=n.prototype)&&i!==r.prototype&&mn(e,i),e},Io=String,To=function(e){if("Symbol"===ir(e))throw TypeError("Cannot convert a Symbol value to a string");return Io(e)},Ro=function(e,t){return void 0===e?arguments.length<2?"":t:To(e)},Po=function(e,t){W(t)&&"cause"in t&&Xe(e,"cause",t.cause)},Ao=Error,ko=A("".replace),Oo=String(Ao("zxcasd").stack),Lo=/\n\s*at [^:]*:[^\n]*/,Do=Lo.test(Oo),Mo=function(e,t){if(Do&&"string"==typeof e&&!Ao.prepareStackTrace)for(;t--;)e=ko(e,Lo,"");return e},No=!g((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",E(1,7)),7!==e.stack)})),jo=function(e,t,r,n){var i="stackTraceLimit",o=n?2:1,s=e.split("."),a=s[s.length-1],c=H.apply(null,s);if(c){var u=c.prototype;if(be(u,"cause")&&delete u.cause,!r)return c;var l=H("Error"),d=t((function(e,t){var r=Ro(n?t:e,void 0),i=n?new c(e):new c;return void 0!==r&&Xe(i,"message",r),No&&Xe(i,"stack",Mo(i.stack,2)),this&&Y(u,this)&&Eo(i,this,d),arguments.length>o&&Po(i,arguments[o]),i}));d.prototype=u,"Error"!==a?mn?mn(d,l):Ut(d,l,{name:!0}):m&&i in c&&(xo(d,c,i),xo(d,c,"prepareStackTrace")),Ut(d,c);try{u.name!==a&&Xe(u,"name",a),u.constructor=d}catch(e){}return d}},Bo=h.WebAssembly,_o=7!==Error("e",{cause:7}).cause,Uo=function(e,t){var r={};r[e]=jo(e,t,_o),Ht({global:!0,constructor:!0,arity:1,forced:_o},r)},Fo=function(e,t){if(Bo&&Bo[e]){var r={};r[e]=jo("WebAssembly."+e,t,_o),Ht({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:_o},r)}};Uo("Error",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("EvalError",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("RangeError",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("ReferenceError",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("SyntaxError",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("TypeError",(function(e){return function(t){return _r(e,this,arguments)}})),Uo("URIError",(function(e){return function(t){return _r(e,this,arguments)}})),Fo("CompileError",(function(e){return function(t){return _r(e,this,arguments)}})),Fo("LinkError",(function(e){return function(t){return _r(e,this,arguments)}})),Fo("RuntimeError",(function(e){return function(t){return _r(e,this,arguments)}}));var Vo=Pe("match"),zo=function(e){var t;return W(e)&&(void 0!==(t=e[Vo])?!!t:"RegExp"==L(e))},$o=function(){var e=ze(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Go=RegExp.prototype,qo=function(e){var t=e.flags;return void 0!==t||"flags"in Go||be(e,"flags")||!Y(Go,e)?t:b($o,e)},Wo=h.RegExp,Xo=g((function(){var e=Wo("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Ho=Xo||g((function(){return!Wo("a","y").sticky})),Yo=Xo||g((function(){var e=Wo("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),Jo={BROKEN_CARET:Yo,MISSED_STICKY:Ho,UNSUPPORTED_Y:Xo},Ko=h.RegExp,Zo=g((function(){var e=Ko(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Qo=h.RegExp,es=g((function(){var e=Qo("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),ts=Nt.f,rs=gt.enforce,ns=Pe("match"),is=h.RegExp,os=is.prototype,ss=h.SyntaxError,as=A(os.exec),cs=A("".charAt),us=A("".replace),ls=A("".indexOf),ds=A("".slice),fs=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,ps=/a/g,hs=/a/g,gs=new is(ps)!==ps,ms=Jo.MISSED_STICKY,vs=Jo.UNSUPPORTED_Y,ys=m&&(!gs||ms||Zo||es||g((function(){return hs[ns]=!1,is(ps)!=ps||is(hs)==hs||"/a/i"!=is(ps,"i")})));if(Wt("RegExp",ys)){for(var bs=function(e,t){var r,n,i,o,s,a,c=Y(os,this),u=zo(e),l=void 0===t,d=[],f=e;if(!c&&u&&l&&e.constructor===bs)return e;if((u||Y(os,e))&&(e=e.source,l&&(t=qo(f))),e=void 0===e?"":To(e),t=void 0===t?"":To(t),f=e,Zo&&"dotAll"in ps&&(n=!!t&&ls(t,"s")>-1)&&(t=us(t,/s/g,"")),r=t,ms&&"sticky"in ps&&(i=!!t&&ls(t,"y")>-1)&&vs&&(t=us(t,/y/g,"")),es&&(o=function(e){for(var t,r=e.length,n=0,i="",o=[],s={},a=!1,c=!1,u=0,l="";n<=r;n++){if("\\"===(t=cs(e,n)))t+=cs(e,++n);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:as(fs,ds(e,n+1))&&(n+=2,c=!0),i+=t,u++;continue;case">"===t&&c:if(""===l||be(s,l))throw new ss("Invalid capture group name");s[l]=!0,o[o.length]=[l,u],c=!1,l="";continue}c?l+=t:i+=t}return[i,o]}(e),e=o[0],d=o[1]),s=Eo(is(e,t),c?this:os,bs),(n||i||d.length)&&(a=rs(s),n&&(a.dotAll=!0,a.raw=bs(function(e){for(var t,r=e.length,n=0,i="",o=!1;n<=r;n++)"\\"!==(t=cs(e,n))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+cs(e,++n);return i}(e),r)),i&&(a.sticky=!0),d.length&&(a.groups=d)),e!==f)try{Xe(s,"source",""===f?"(?:)":f)}catch(e){}return s},ws=ts(is),Ss=0;ws.length>Ss;)xo(bs,is,ws[Ss++]);os.constructor=bs,bs.prototype=os,vt(h,"RegExp",bs,{constructor:!0})}Sn("RegExp");var Cs,xs,Es,Is=gt.get,Ts=RegExp.prototype,Rs=TypeError;m&&Zo&&(Cs=Ts,xs="dotAll",(Es={configurable:!0,get:function(){if(this!==Ts){if("RegExp"===L(this))return!!Is(this).dotAll;throw Rs("Incompatible receiver, RegExp required")}}}).get&&mt(Es.get,xs,{getter:!0}),Es.set&&mt(Es.set,xs,{setter:!0}),We.f(Cs,xs,Es));var Ps,As=Object.keys||function(e){return Lt(e,Dt)},ks=m&&!Ue?Object.defineProperties:function(e,t){ze(e);for(var r,n=U(t),i=As(t),o=i.length,s=0;o>s;)We.f(e,r=i[s++],n[r]);return e},Os={f:ks},Ls=st("IE_PROTO"),Ds=function(){},Ms=function(e){return"<script>"+e+"<\/script>"},Ns=function(e){e.write(Ms("")),e.close();var t=e.parentWindow.Object;return e=null,t},js=function(){try{Ps=new ActiveXObject("htmlfile")}catch(e){}var e,t;js="undefined"!=typeof document?document.domain&&Ps?Ns(Ps):((t=Ne("iframe")).style.display="none",Rn.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ms("document.F=Object")),e.close(),e.F):Ns(Ps);for(var r=Dt.length;r--;)delete js.prototype[Dt[r]];return js()};at[Ls]=!0;var Bs=Object.create||function(e,t){var r;return null!==e?(Ds.prototype=ze(e),r=new Ds,Ds.prototype=null,r[Ls]=e):r=js(),void 0===t?r:Os.f(r,t)},_s=gt.get,Us=ge("native-string-replace",String.prototype.replace),Fs=RegExp.prototype.exec,Vs=Fs,zs=A("".charAt),$s=A("".indexOf),Gs=A("".replace),qs=A("".slice),Ws=function(){var e=/a/,t=/b*/g;return b(Fs,e,"a"),b(Fs,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Xs=Jo.BROKEN_CARET,Hs=void 0!==/()??/.exec("")[1];(Ws||Hs||Xs||Zo||es)&&(Vs=function(e){var t,r,n,i,o,s,a,c=this,u=_s(c),l=To(e),d=u.raw;if(d)return d.lastIndex=c.lastIndex,t=b(Vs,d,l),c.lastIndex=d.lastIndex,t;var f=u.groups,p=Xs&&c.sticky,h=b($o,c),g=c.source,m=0,v=l;if(p&&(h=Gs(h,"y",""),-1===$s(h,"g")&&(h+="g"),v=qs(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==zs(l,c.lastIndex-1))&&(g="(?: "+g+")",v=" "+v,m++),r=new RegExp("^(?:"+g+")",h)),Hs&&(r=new RegExp("^"+g+"$(?!\\s)",h)),Ws&&(n=c.lastIndex),i=b(Fs,p?r:c,v),p?i?(i.input=qs(i.input,m),i[0]=qs(i[0],m),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:Ws&&i&&(c.lastIndex=c.global?i.index+i[0].length:n),Hs&&i&&i.length>1&&b(Us,i[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&f)for(i.groups=s=Bs(null),o=0;o<f.length;o++)s[(a=f[o])[0]]=i[a[1]];return i});var Ys=Vs;Ht({target:"RegExp",proto:!0,forced:/./.exec!==Ys},{exec:Ys});var Js=A(x.f),Ks=A([].push),Zs=function(e){return function(t){for(var r,n=U(t),i=As(n),o=i.length,s=0,a=[];o>s;)r=i[s++],m&&!Js(n,r)||Ks(a,e?[r,n[r]]:n[r]);return a}},Qs={entries:Zs(!0),values:Zs(!1)}.values;Ht({target:"Object",stat:!0},{values:function(e){return Qs(e)}});var ea=Pe("species"),ta=RegExp.prototype,ra=function(e,t,r,n){var i=Pe(e),o=!g((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=o&&!g((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[ea]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!o||!s||r){var a=A(/./[i]),c=t(i,""[e],(function(e,t,r,n,i){var s=A(e),c=t.exec;return c===Ys||c===ta.exec?o&&!i?{done:!0,value:a(t,r,n)}:{done:!0,value:s(r,t,n)}:{done:!1}}));vt(String.prototype,e,c[0]),vt(ta,i,c[1])}n&&Xe(ta[i],"sham",!0)},na=A("".charAt),ia=A("".charCodeAt),oa=A("".slice),sa=function(e){return function(t,r){var n,i,o=To(_(t)),s=St(r),a=o.length;return s<0||s>=a?e?"":void 0:(n=ia(o,s))<55296||n>56319||s+1===a||(i=ia(o,s+1))<56320||i>57343?e?na(o,s):n:e?oa(o,s,s+2):i-56320+(n-55296<<10)+65536}},aa={codeAt:sa(!1),charAt:sa(!0)}.charAt,ca=function(e,t,r){return t+(r?aa(e,t).length:1)},ua=TypeError,la=function(e,t){var r=e.exec;if(G(r)){var n=b(r,e,t);return null!==n&&ze(n),n}if("RegExp"===L(e))return b(Ys,e,t);throw ua("RegExp#exec called on incompatible receiver")};ra("match",(function(e,t,r){return[function(t){var r=_(this),n=j(t)?void 0:le(t,e);return n?b(n,t,r):new RegExp(t)[e](To(r))},function(e){var n=ze(this),i=To(e),o=r(t,n,i);if(o.done)return o.value;if(!n.global)return la(n,i);var s=n.unicode;n.lastIndex=0;for(var a,c=[],u=0;null!==(a=la(n,i));){var l=To(a[0]);c[u]=l,""===l&&(n.lastIndex=ca(i,Tt(n.lastIndex),s)),u++}return 0===u?null:c}]}));var da=We.f,fa=Pe("unscopables"),pa=Array.prototype;null==pa[fa]&&da(pa,fa,{configurable:!0,value:Bs(null)});var ha,ga,ma,va=function(e){pa[fa][e]=!0},ya=!g((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),ba=st("IE_PROTO"),wa=Object,Sa=wa.prototype,Ca=ya?wa.getPrototypeOf:function(e){var t=ve(e);if(be(t,ba))return t[ba];var r=t.constructor;return G(r)&&t instanceof r?r.prototype:t instanceof wa?Sa:null},xa=Pe("iterator"),Ea=!1;[].keys&&("next"in(ma=[].keys())?(ga=Ca(Ca(ma)))!==Object.prototype&&(ha=ga):Ea=!0);var Ia=!W(ha)||g((function(){var e={};return ha[xa].call(e)!==e}));Ia&&(ha={}),G(ha[xa])||vt(ha,xa,(function(){return this}));var Ta={IteratorPrototype:ha,BUGGY_SAFARI_ITERATORS:Ea},Ra=Ta.IteratorPrototype,Pa=function(){return this},Aa=function(e,t,r,n){var i=t+" Iterator";return e.prototype=Bs(Ra,{next:E(+!n,r)}),bn(e,i,!1),Zi[i]=Pa,e},ka=Ke.PROPER,Oa=Ke.CONFIGURABLE,La=Ta.IteratorPrototype,Da=Ta.BUGGY_SAFARI_ITERATORS,Ma=Pe("iterator"),Na=function(){return this},ja=function(e,t,r,n,i,o,s){Aa(r,t,n);var a,c,u,l=function(e){if(e===i&&g)return g;if(!Da&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",f=!1,p=e.prototype,h=p[Ma]||p["@@iterator"]||i&&p[i],g=!Da&&h||l(i),m="Array"==t&&p.entries||h;if(m&&(a=Ca(m.call(new e)))!==Object.prototype&&a.next&&(Ca(a)!==La&&(mn?mn(a,La):G(a[Ma])||vt(a,Ma,Na)),bn(a,d,!0)),ka&&"values"==i&&h&&"values"!==h.name&&(Oa?Xe(p,"name","values"):(f=!0,g=function(){return b(h,this)})),i)if(c={values:l("values"),keys:o?g:l("keys"),entries:l("entries")},s)for(u in c)(Da||f||!(u in p))&&vt(p,u,c[u]);else Ht({target:t,proto:!0,forced:Da||f},c);return p[Ma]!==g&&vt(p,Ma,g,{name:i}),Zi[t]=g,c},Ba=function(e,t){return{value:e,done:t}},_a=We.f,Ua=gt.set,Fa=gt.getterFor("Array Iterator"),Va=ja(Array,"Array",(function(e,t){Ua(this,{type:"Array Iterator",target:U(e),index:0,kind:t})}),(function(){var e=Fa(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,Ba(void 0,!0)):Ba("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),za=Zi.Arguments=Zi.Array;if(va("keys"),va("values"),va("entries"),m&&"values"!==za.name)try{_a(za,"name",{value:"values"})}catch(e){}var $a={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ga=Ne("span").classList,qa=Ga&&Ga.constructor&&Ga.constructor.prototype,Wa=qa===Object.prototype?void 0:qa,Xa=Pe("iterator"),Ha=Pe("toStringTag"),Ya=Va.values,Ja=function(e,t){if(e){if(e[Xa]!==Ya)try{Xe(e,Xa,Ya)}catch(t){e[Xa]=Ya}if(e[Ha]||Xe(e,Ha,t),$a[t])for(var r in Va)if(e[r]!==Va[r])try{Xe(e,r,Va[r])}catch(t){e[r]=Va[r]}}};for(var Ka in $a)Ja(h[Ka]&&h[Ka].prototype,Ka);Ja(Wa,"DOMTokenList");var Za=Array,Qa=Math.max,ec=Nt.f,tc="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],rc=function(e){try{return ec(e)}catch(e){return function(e,t,r){for(var n=Rt(e),i=Et(t,n),o=Et(void 0===r?n:r,n),s=Za(Qa(o-i,0)),a=0;i<o;i++,a++)Zt(s,a,e[i]);return s.length=a,s}(tc)}},nc={f:function(e){return tc&&"Window"==L(e)?rc(e):ec(U(e))}},ic=g((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),oc=Object.isExtensible,sc=g((function(){oc(1)}))||ic?function(e){return!!W(e)&&((!ic||"ArrayBuffer"!=L(e))&&(!oc||oc(e)))}:oc,ac=!g((function(){return Object.isExtensible(Object.preventExtensions({}))})),cc=l((function(e){var t=We.f,r=!1,n=xe("meta"),i=0,o=function(e){t(e,n,{value:{objectID:"O"+i++,weakData:{}}})},s=e.exports={enable:function(){s.enable=function(){},r=!0;var e=Nt.f,t=A([].splice),i={};i[n]=1,e(i).length&&(Nt.f=function(r){for(var i=e(r),o=0,s=i.length;o<s;o++)if(i[o]===n){t(i,o,1);break}return i},Ht({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:nc.f}))},fastKey:function(e,t){if(!W(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!be(e,n)){if(!sc(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!be(e,n)){if(!sc(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return ac&&r&&sc(e)&&!be(e,n)&&o(e),e}};at[n]=!0})),uc=function(e,t,r){for(var n in t)vt(e,n,t[n],r);return e},lc=We.f,dc=cc.fastKey,fc=gt.set,pc=gt.getterFor,hc={getConstructor:function(e,t,r,n){var i=e((function(e,i){xn(e,o),fc(e,{type:t,index:Bs(null),first:void 0,last:void 0,size:0}),m||(e.size=0),j(i)||lo(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,s=pc(t),a=function(e,t,r){var n,i,o=s(e),a=c(e,t);return a?a.value=r:(o.last=a={index:i=dc(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=a),n&&(n.next=a),m?o.size++:e.size++,"F"!==i&&(o.index[i]=a)),e},c=function(e,t){var r,n=s(e),i=dc(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return uc(o,{clear:function(){for(var e=s(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,m?e.size=0:this.size=0},delete:function(e){var t=this,r=s(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),m?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=s(this),n=Ar(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),uc(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),m&&lc(o,"size",{get:function(){return s(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=pc(t),o=pc(n);ja(e,t,(function(e,t){fc(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?Ba("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,Ba(void 0,!0))}),r?"entries":"values",!r,!0),Sn(t)}};!function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=n?"set":"add",s=h[e],a=s&&s.prototype,c=s,u={},l=function(e){var t=A(a[e]);vt(a,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!W(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!W(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!W(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(Wt(e,!G(s)||!(i||a.forEach&&!g((function(){(new s).entries().next()})))))c=r.getConstructor(t,e,n,o),cc.enable();else if(Wt(e,!0)){var d=new c,f=d[o](i?{}:-0,1)!=d,p=g((function(){d.has(1)})),m=mo((function(e){new s(e)})),v=!i&&g((function(){for(var e=new s,t=5;t--;)e[o](t,t);return!e.has(-0)}));m||((c=t((function(e,t){xn(e,a);var r=Eo(new s,e,c);return j(t)||lo(t,r[o],{that:r,AS_ENTRIES:n}),r}))).prototype=a,a.constructor=c),(p||v)&&(l("delete"),l("has"),n&&l("get")),(v||f)&&l(o),i&&a.clear&&delete a.clear}u[e]=c,Ht({global:!0,constructor:!0,forced:c!=s},u),bn(c,e),i||r.setStrong(c,e,n)}("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),hc);var gc,mc="object"==typeof Reflect?Reflect:null,vc=mc&&"function"==typeof mc.apply?mc.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};gc=mc&&"function"==typeof mc.ownKeys?mc.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var yc=Number.isNaN||function(e){return e!=e};function bc(){bc.init.call(this)}var wc=bc,Sc=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}Oc(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&Oc(e,"error",t,r)}(e,i,{once:!0})}))};bc.EventEmitter=bc,bc.prototype._events=void 0,bc.prototype._eventsCount=0,bc.prototype._maxListeners=void 0;var Cc=10;function xc(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function Ec(e){return void 0===e._maxListeners?bc.defaultMaxListeners:e._maxListeners}function Ic(e,t,r,n){var i,o,s,a;if(xc(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=Ec(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function Tc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Rc(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=Tc.bind(n);return i.listener=r,n.wrapFn=i,i}function Pc(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):kc(i,i.length)}function Ac(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function kc(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function Oc(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(bc,"defaultMaxListeners",{enumerable:!0,get:function(){return Cc},set:function(e){if("number"!=typeof e||e<0||yc(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Cc=e}}),bc.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},bc.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||yc(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},bc.prototype.getMaxListeners=function(){return Ec(this)},bc.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)vc(a,this,t);else{var c=a.length,u=kc(a,c);for(r=0;r<c;++r)vc(u[r],this,t)}return!0},bc.prototype.addListener=function(e,t){return Ic(this,e,t,!1)},bc.prototype.on=bc.prototype.addListener,bc.prototype.prependListener=function(e,t){return Ic(this,e,t,!0)},bc.prototype.once=function(e,t){return xc(t),this.on(e,Rc(this,e,t)),this},bc.prototype.prependOnceListener=function(e,t){return xc(t),this.prependListener(e,Rc(this,e,t)),this},bc.prototype.removeListener=function(e,t){var r,n,i,o,s;if(xc(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},bc.prototype.off=bc.prototype.removeListener,bc.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},bc.prototype.listeners=function(e){return Pc(this,e,!0)},bc.prototype.rawListeners=function(e){return Pc(this,e,!1)},bc.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ac.call(e,t)},bc.prototype.listenerCount=Ac,bc.prototype.eventNames=function(){return this._eventsCount>0?gc(this._events):[]},wc.once=Sc;var Lc=Nc,Dc=function(e,t){var r=new Mc;return Nc(e,r,t),r},Mc=wc.EventEmitter;function Nc(e,t,r){Array.isArray(r)||(r=[r]);var n=[];return r.forEach((function(r){var i=function(){var e=[].slice.call(arguments);e.unshift(r),t.emit.apply(t,e)};n.push(i),e.on(r,i)})),function(){r.forEach((function(t,r){e.removeListener(t,n[r])}))}}Lc.filter=Dc;var jc=At.includes,Bc=g((function(){return!Array(1).includes()}));Ht({target:"Array",proto:!0,forced:Bc},{includes:function(e){return jc(this,e,arguments.length>1?arguments[1]:void 0)}}),va("includes");var _c=TypeError,Uc=function(e){if(zo(e))throw _c("The method doesn't accept regular expressions");return e},Fc=Pe("match"),Vc=A("".indexOf);Ht({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Fc]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Vc(To(_(this)),To(Uc(e)),arguments.length>1?arguments[1]:void 0)}});const zc=cn.get("PeerConnectionStats"),$c="stats";class Gc extends wc{constructor(e){super(),this.peer=e,this.stats=null,this.emitInterval=null,this.previousStats=null}init(){var e=this;zc.info("Initializing peer connection stats"),this.emitInterval=setInterval(n((function*(){const t=yield e.peer.getStats();e.parseStats(t),e.emit($c,e.stats)})),1e3)}parseStats(e){this.previousStats=this.stats;const t={audio:{inbounds:[],outbounds:[]},video:{inbounds:[],outbounds:[]},raw:e};var r,n=c(e.values());try{for(n.s();!(r=n.n()).done;){const e=r.value;switch(e.type){case"outbound-rtp":qc(e,this.previousStats,t);break;case"inbound-rtp":Wc(e,this.previousStats,t);break;case"candidate-pair":e.nominated&&Xc(e,t)}}}catch(e){n.e(e)}finally{n.f()}this.stats=t}stop(){zc.info("Stopping peer connection stats"),clearInterval(this.emitInterval)}}const qc=(e,r,n)=>{var i,o;const s=Hc(e),a=Yc(e.codecId,n.raw),c=Jc(e,s);c.totalBytesSent=e.bytesSent,c.id=e.id,c.mid=e.mid;const u=r?null!==(i=null===(o=r[s].outbounds.find((e=>e.id===c.id)))||void 0===o?void 0:o.totalBytesSent)&&void 0!==i?i:0:null;c.bitrate=u?8*(e.bytesSent-u):0,"video"===s&&(c.qualityLimitationReason=e.qualityLimitationReason),n[s].outbounds.push(t(t({},a),c))},Wc=(e,r,n)=>{let i=Hc(e);const o=Yc(e.codecId,n.raw);["audio","video"].includes(i)||(i=e.id.includes("Video")?"video":"audio");const s=Jc(e,i);if(s.totalBytesReceived=e.bytesReceived,s.totalPacketsReceived=e.packetsReceived,s.totalPacketsLost=e.packetsLost,s.jitter=e.jitter,s.id=e.id,s.mid=e.mid,s.bitrate=0,s.packetsLostRatioPerSecond=0,s.packetsLostDeltaPerSecond=0,r){const t=r[i].inbounds.find((e=>e.id===s.id));if(t){const r=t.totalBytesReceived;s.bitrate=8*(e.bytesReceived-r),s.packetsLostRatioPerSecond=Kc(s,t),s.packetsLostDeltaPerSecond=Zc(s,t)}}n[i].inbounds.push(t(t({},o),s))},Xc=(e,t)=>{t.totalRoundTripTime=e.totalRoundTripTime,t.currentRoundTripTime=e.currentRoundTripTime,t.availableOutgoingBitrate=e.availableOutgoingBitrate,t.candidateType=t.raw.get(e.localCandidateId).candidateType},Hc=e=>e.mediaType||e.kind,Yc=(e,t)=>{var r;return{mimeType:(e&&null!==(r=t.get(e))&&void 0!==r?r:{}).mimeType}},Jc=(e,t)=>{const r={};return"video"===t&&(r.framesPerSecond=e.framesPerSecond,r.frameHeight=e.frameHeight,r.frameWidth=e.frameWidth),r.timestamp=e.timestamp,r},Kc=(e,t)=>Zc(e,t)/(e.totalPacketsReceived-t.totalPacketsReceived),Zc=(e,t)=>e.totalPacketsLost-t.totalPacketsLost;var Qc=function(e,t,r,n){try{return n?t(ze(r)[0],r[1]):t(r)}catch(t){so(e,"throw",t)}},eu=Array,tu=!mo((function(e){Array.from(e)}));Ht({target:"Array",stat:!0,forced:tu},{from:function(e){var t=ve(e),r=pr(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Ar(i,n>2?arguments[2]:void 0));var s,a,c,u,l,d,f=no(t),p=0;if(!f||this===eu&&to(f))for(s=Rt(t),a=r?new this(s):eu(s);s>p;p++)d=o?i(t[p],p):t[p],Zt(a,p,d);else for(l=(u=oo(t,f)).next,a=r?new this:[];!(c=b(l,u)).done;p++)d=o?Qc(u,i,[c.value,p],!0):c.value,Zt(a,p,d);return a.length=p,a}});var ru=Math.floor,nu=A("".charAt),iu=A("".replace),ou=A("".slice),su=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,au=/\$([$&'`]|\d{1,2})/g,cu=function(e,t,r,n,i,o){var s=r+e.length,a=n.length,c=au;return void 0!==i&&(i=ve(i),c=su),iu(o,c,(function(o,c){var u;switch(nu(c,0)){case"$":return"$";case"&":return e;case"`":return ou(t,0,r);case"'":return ou(t,s);case"<":u=i[ou(c,1,-1)];break;default:var l=+c;if(0===l)return o;if(l>a){var d=ru(l/10);return 0===d?o:d<=a?void 0===n[d-1]?nu(c,1):n[d-1]+nu(c,1):o}u=n[l-1]}return void 0===u?"":u}))},uu=Pe("replace"),lu=Math.max,du=Math.min,fu=A([].concat),pu=A([].push),hu=A("".indexOf),gu=A("".slice),mu="$0"==="a".replace(/./,"$0"),vu=!!/./[uu]&&""===/./[uu]("a","$0"),yu=!g((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));ra("replace",(function(e,t,r){var n=vu?"$":"$0";return[function(e,r){var n=_(this),i=j(e)?void 0:le(e,uu);return i?b(i,e,n,r):b(t,To(n),e,r)},function(e,i){var o=ze(this),s=To(e);if("string"==typeof i&&-1===hu(i,n)&&-1===hu(i,"$<")){var a=r(t,o,s,i);if(a.done)return a.value}var c=G(i);c||(i=To(i));var u=o.global;if(u){var l=o.unicode;o.lastIndex=0}for(var d=[];;){var f=la(o,s);if(null===f)break;if(pu(d,f),!u)break;""===To(f[0])&&(o.lastIndex=ca(s,Tt(o.lastIndex),l))}for(var p,h="",g=0,m=0;m<d.length;m++){for(var v=To((f=d[m])[0]),y=lu(du(St(f.index),s.length),0),b=[],w=1;w<f.length;w++)pu(b,void 0===(p=f[w])?p:String(p));var S=f.groups;if(c){var C=fu([v],b,y,s);void 0!==S&&pu(C,S);var x=To(_r(i,void 0,C))}else x=cu(v,s,y,b,S,i);y>=g&&(h+=gu(s,g,y)+x,g=y+v.length)}return h+gu(s,g)}]}),!yu||!mu||vu);var bu=Lr.filter,wu=yr("filter");Ht({target:"Array",proto:!0,forced:!wu},{filter:function(e){return bu(this,e,arguments.length>1?arguments[1]:void 0)}});var Su,Cu="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",xu=A("".replace),Eu="["+Cu+"]",Iu=RegExp("^"+Eu+Eu+"*"),Tu=RegExp(Eu+Eu+"*$"),Ru=function(e){return function(t){var r=To(_(t));return 1&e&&(r=xu(r,Iu,"")),2&e&&(r=xu(r,Tu,"")),r}},Pu={start:Ru(1),end:Ru(2),trim:Ru(3)},Au=Ke.PROPER,ku=Pu.trim;Ht({target:"String",proto:!0,forced:(Su="trim",g((function(){return!!Cu[Su]()||"âÂá "!=="âÂá "[Su]()||Au&&Cu[Su].name!==Su})))},{trim:function(){return ku(this)}});var Ou=Pe("matchAll"),Lu=gt.set,Du=gt.getterFor("RegExp String Iterator"),Mu=RegExp.prototype,Nu=TypeError,ju=A("".indexOf),Bu=A("".matchAll),_u=!!Bu&&!g((function(){Bu("a",/./)})),Uu=Aa((function(e,t,r,n){Lu(this,{type:"RegExp String Iterator",regexp:e,string:t,global:r,unicode:n,done:!1})}),"RegExp String",(function(){var e=Du(this);if(e.done)return Ba(void 0,!0);var t=e.regexp,r=e.string,n=la(t,r);return null===n?(e.done=!0,Ba(void 0,!0)):e.global?(""===To(n[0])&&(t.lastIndex=ca(r,Tt(t.lastIndex),e.unicode)),Ba(n,!1)):(e.done=!0,Ba(n,!1))})),Fu=function(e){var t,r,n,i=ze(this),o=To(e),s=Tn(i,RegExp),a=To(qo(i));return t=new s(s===RegExp?i.source:i,a),r=!!~ju(a,"g"),n=!!~ju(a,"u"),t.lastIndex=Tt(i.lastIndex),new Uu(t,o,r,n)};Ht({target:"String",proto:!0,forced:_u},{matchAll:function(e){var t,r,n,i=_(this);if(j(e)){if(_u)return Bu(i,e)}else{if(zo(e)&&(t=To(_(qo(e))),!~ju(t,"g")))throw Nu("`.matchAll` does not allow non-global regexes");if(_u)return Bu(i,e);if(n=le(e,Ou))return b(n,e,i)}return r=To(i),new RegExp(e,"g")[Ou](r)}}),Ou in Mu||vt(Mu,Ou,Fu);var Vu=A([].reverse),zu=[1,2];Ht({target:"Array",proto:!0,forced:String(zu)===String(zu.reverse())},{reverse:function(){return Yt(this)&&(this.length=this.length),Vu(this)}});var $u=l((function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),Gu=l((function(e,t){var r=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),o=r[r.length-1]);for(var s=0;s<($u[t]||[]).length;s+=1){var a=$u[t][s];if(a.reg.test(i))return n(a,o,i)}})),t.media=r,t};var o=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}})),qu=/%[sdv%]/g,Wu=function(e){var t=1,r=arguments,n=r.length;return e.replace(qu,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},Xu=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return Wu.apply(null,n)},Hu=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Yu=["i","c","b","a"],Ju={write:function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||Hu,n=t.innerOrder||Yu,i=[];return r.forEach((function(t){$u[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Xu(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Xu(t,r,e))}))}))})),e.media.forEach((function(e){i.push(Xu("m",$u.m[0],e)),n.forEach((function(t){$u[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Xu(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Xu(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parse:Gu.parse,parseParams:Gu.parseParams,parseFmtpConfig:Gu.parseFmtpConfig,parsePayloads:Gu.parsePayloads,parseRemoteCandidates:Gu.parseRemoteCandidates,parseImageAttributes:Gu.parseImageAttributes,parseSimulcastStreamList:Gu.parseSimulcastStreamList};class Ku{constructor(e,t,r,n,i,o,s,a,c){this.foundation=e,this.componentId=t,this.transport=r,this.priority=n,this.address=i,this.port=o,this.type=s,this.relAddr=a,this.relPort=c}equals(e){return e.foundation===this.foundation&&e.componentId===this.componentId&&e.transport===this.transport&&e.priority===this.priority&&e.address===this.address&&e.port===this.port&&e.type===this.type&&e.relAddr===this.relAddr&&e.relPort===this.relPort}clone(){return new Ku(this.foundation,this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.relAddr,this.relPort)}plain(){const e={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type};return this.relAddr&&(e.relAddr=this.relAddr),this.relPort&&(e.relPort=this.relPort),e}getFoundation(){return this.foundation}getComponentId(){return this.componentId}getTransport(){return this.transport}getPriority(){return this.priority}getAddress(){return this.address}getPort(){return this.port}getType(){return this.type}getRelAddr(){return this.relAddr}getRelPort(){return this.relPort}}Ku.expand=function(e){return new Ku(e.foundation,e.componentId,e.transport,e.priority,e.address,e.port,e.type,e.relAddr,e.relPort)};var Zu=Ku;class Qu{constructor(e,t){this.id=e,this.params=t||[]}clone(){return new Qu(this.id,this.params)}plain(){return this.params.length?{id:this.id,params:this.params}:{id:this.id}}getId(){return this.id}getParams(){return this.params}}Qu.expand=function(e){return new Qu(e.id,e.params)};var el=Qu;class tl{constructor(e,t,r){this.codec=e,this.type=t,this.params={},this.rtcpfbs=new Set,r&&this.addParams(r)}clone(){const e=new tl(this.codec,this.type,this.params);this.hasRTX()&&e.setRTX(this.getRTX());for(const t of this.rtcpfbs)e.addRTCPFeedback(t.clone());return this.hasChannels()&&e.setChannels(this.getChannels()),e}plain(){const e={codec:this.codec,type:this.type};this.rtx&&(e.rtx=this.rtx),this.channels&&(e.channels=this.channels),Object.keys(this.params).length&&(e.params=this.params);for(const t of this.rtcpfbs)e.rtcpfbs||(e.rtcpfbs=[]),e.rtcpfbs.push(t.plain());return e}setRTX(e){this.rtx=e}getType(){return this.type}setType(e){this.type=e}getCodec(){return this.codec}getParams(){return this.params}addParams(e){for(const t in e)this.params[t]=e[t]}addParam(e,t){this.params[e]=t}hasParam(e){return this.params.hasOwnProperty(e)}getParam(e,t){return this.hasParam(e)?this.params[e]:""+t}hasRTX(){return this.rtx}getRTX(){return this.rtx}hasChannels(){return this.channels}getChannels(){return this.channels}setChannels(e){this.channels=e}addRTCPFeedback(e){this.rtcpfbs.add(e)}getRTCPFeedbacks(){return this.rtcpfbs}}tl.expand=function(e){const t=new tl(e.codec,e.type,e.params);e.rtx&&t.setRTX(e.rtx),e.channels&&t.setChannels(e.channels);for(let r=0;e.rtcpfbs&&r<e.rtcpfbs.length;++r){const n=el.expand(e.rtcpfbs[r]);t.addRTCPFeedback(n)}return t},tl.MapFromNames=function(e,t,r){const n=new Map;let i=96;for(let o=0;o<e.length;++o){let s;const a=e[o].split(";"),c=a[0].toLowerCase().trim();s="pcmu"===c?0:"pcma"===c?8:++i;const u=new tl(c,s);"opus"===c?u.setChannels(2):"multiopus"===c&&u.setChannels(6),t&&"ulpfec"!==c&&"flexfec-03"!==c&&"red"!==c&&u.setRTX(++i);for(let e=0;r&&e<r.length;++e)u.addRTCPFeedback(new el(r[e].id,r[e].params));for(let e=1;e<a.length;++e){let t=a[e].split("=");u.addParam(t[0].trim(),t[1].trim())}n.set(u.getCodec().toLowerCase(),u)}return n};var rl=tl;var nl=function e(){var t=this;if(!(this instanceof e))return new(Function.prototype.bind.apply(e,[null].concat(Array.prototype.slice.call(arguments))));Array.from(arguments).forEach((function(e){t[e]=Symbol.for("MEDOOZE_SEMANTIC_SDP_"+e)}))};const il=nl("ACTIVE","PASSIVE","ACTPASS","INACTIVE");il.byValue=function(e){switch(e){case il.ACTIVE:case il.PASSIVE:case il.ACTPASS:case il.INACTIVE:return e}return il[e.toUpperCase()]},il.toString=function(e){switch(e){case il.ACTIVE:return"active";case il.PASSIVE:return"passive";case il.ACTPASS:return"actpass";case il.INACTIVE:return"inactive"}},il.reverse=function(e){switch(e){case il.ACTIVE:return il.PASSIVE;case il.PASSIVE:return il.ACTIVE;case il.ACTPASS:return il.PASSIVE;case il.INACTIVE:return il.INACTIVE}};var ol=il;class sl{constructor(e,t,r){this.setup=e,this.hash=t,this.fingerprint=r}clone(){return new sl(this.setup,this.hash,this.fingerprint)}plain(){return{setup:ol.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}}getFingerprint(){return this.fingerprint}getHash(){return this.hash}getSetup(){return this.setup}setSetup(e){this.setup=e}}sl.expand=function(e){return new sl(e.setup?ol.byValue(e.setup):ol.ACTPASS,e.hash,e.fingerprint)};var al=sl;class cl{constructor(e,t,r,n){this.tag=e,this.suite=t,this.keyParams=r,this.sessionParams=n}clone(){return new cl(this.tag,this.suite,this.keyParams,this.sessionParams)}plain(){return{tag:this.tag,suite:this.suite,keyParams:this.keyParams,sessionParams:this.sessionParams}}getSessionParams(){return this.sessionParams}getKeyParams(){return this.keyParams}getSuite(){return this.suite}getTag(){return this.tag}}cl.expand=function(e){return new cl(e.tag,e.suite,e.keyParams,e.sessionParams)};for(var ul=cl,ll=function(e){var t=bl(e),r=t[0],n=t[1];return 3*(r+n)/4-n},dl=function(e){var t,r,n=bl(e),i=n[0],o=n[1],s=new gl(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),a=0,c=o>0?i-4:i;for(r=0;r<c;r+=4)t=hl[e.charCodeAt(r)]<<18|hl[e.charCodeAt(r+1)]<<12|hl[e.charCodeAt(r+2)]<<6|hl[e.charCodeAt(r+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;2===o&&(t=hl[e.charCodeAt(r)]<<2|hl[e.charCodeAt(r+1)]>>4,s[a++]=255&t);1===o&&(t=hl[e.charCodeAt(r)]<<10|hl[e.charCodeAt(r+1)]<<4|hl[e.charCodeAt(r+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t);return s},fl=function(e){for(var t,r=e.length,n=r%3,i=[],o=16383,s=0,a=r-n;s<a;s+=o)i.push(wl(e,s,s+o>a?a:s+o));1===n?(t=e[r-1],i.push(pl[t>>2]+pl[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(pl[t>>10]+pl[t>>4&63]+pl[t<<2&63]+"="));return i.join("")},pl=[],hl=[],gl="undefined"!=typeof Uint8Array?Uint8Array:Array,ml="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vl=0,yl=ml.length;vl<yl;++vl)pl[vl]=ml[vl],hl[ml.charCodeAt(vl)]=vl;function bl(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function wl(e,t,r){for(var n,i,o=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(pl[(i=n)>>18&63]+pl[i>>12&63]+pl[i>>6&63]+pl[63&i]);return o.join("")}hl["-".charCodeAt(0)]=62,hl["_".charCodeAt(0)]=63;var Sl={byteLength:ll,toByteArray:dl,fromByteArray:fl},Cl=function(e,t,r,n,i){var o,s,a=8*i-n-1,c=(1<<a)-1,u=c>>1,l=-7,d=r?i-1:0,f=r?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)},xl=function(e,t,r,n,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,h=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?f/c:f*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=h,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+p]=255&s,p+=h,s/=256,u-=8);e[r+p-h]|=128*g},El=l((function(e,t){const r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=o,t.SlowBuffer=function(e){+e!=e&&(e=0);return o.alloc(+e)},t.INSPECT_MAX_BYTES=50;const n=2147483647;function i(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return s(e,t,r)}function s(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|f(e,t);let n=i(r);const s=n.write(e,t);s!==r&&(n=n.slice(0,s));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(W(e,Uint8Array)){const t=new Uint8Array(e);return l(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(W(e,ArrayBuffer)||e&&W(e.buffer,ArrayBuffer))return l(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(W(e,SharedArrayBuffer)||e&&W(e.buffer,SharedArrayBuffer)))return l(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);const s=function(e){if(o.isBuffer(e)){const t=0|d(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||X(e.length)?i(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return a(e),i(e<0?0:0|d(e))}function u(e){const t=e.length<0?0:0|d(e.length),r=i(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function l(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,o.prototype),n}function d(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||W(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(i)return n?-1:$(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return I(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return C(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function h(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){let o,s=1,a=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let n=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===c)return n*s}else-1!==n&&(o-=o-n),n=-1}else for(r+c>a&&(r=a-c),o=r;o>=0;o--){let r=!0;for(let n=0;n<c;n++)if(u(e,o+n)!==u(t,n)){r=!1;break}if(r)return o}return-1}function v(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const o=t.length;let s;for(n>o/2&&(n=o/2),s=0;s<n;++s){const n=parseInt(t.substr(2*s,2),16);if(X(n))return s;e[r+s]=n}return s}function y(e,t,r,n){return q($(t,e.length-r),e,r,n)}function b(e,t,r,n){return q(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return q(G(t),e,r,n)}function S(e,t,r,n){return q(function(e,t){let r,n,i;const o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function C(e,t,r){return 0===t&&r===e.length?Sl.fromByteArray(e):Sl.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let o=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=r){let r,n,a,c;switch(s){case 1:t<128&&(o=t);break;case 2:r=e[i+1],128==(192&r)&&(c=(31&t)<<6|63&r,c>127&&(o=c));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(c=(15&t)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(o=c))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}return function(e){const t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=E));return r}(n)}t.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return s(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return function(e,t,r){return a(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(W(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),W(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=o.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(W(t,Uint8Array))i+t.length>n.length?(o.isBuffer(t)||(t=o.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!o.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)h(this,t,t+1);return this},o.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},o.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},o.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(W(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0);const c=Math.min(s,a),u=this.slice(n,i),l=e.slice(t,r);for(let e=0;e<c;++e)if(u[e]!==l[e]){s=u[e],a=l[e];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return y(this,e,t,r);case"ascii":case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const E=4096;function I(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function R(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=H[e[n]];return i}function P(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function A(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,r,n,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n,i){U(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,r}function L(e,t,r,n,i){U(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r+7]=o,o>>=8,e[r+6]=o,o>>=8,e[r+5]=o,o>>=8,e[r+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=s,s>>=8,e[r+2]=s,s>>=8,e[r+1]=s,s>>=8,e[r]=s,r+8}function D(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,n,i){return t=+t,r>>>=0,i||D(e,0,r,4),xl(e,t,r,n,23,4),r+4}function N(e,t,r,n,i){return t=+t,r>>>=0,i||D(e,0,r,8),xl(e,t,r,n,52,8),r+8}o.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||A(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||A(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||A(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readBigUInt64LE=Y((function(e){F(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||V(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),o.prototype.readBigUInt64BE=Y((function(e){F(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||V(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||A(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||A(e,t,this.length);let n=t,i=1,o=this[e+--n];for(;n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||A(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||A(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readBigInt64LE=Y((function(e){F(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||V(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),o.prototype.readBigInt64BE=Y((function(e){F(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||V(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),o.prototype.readFloatLE=function(e,t){return e>>>=0,t||A(e,4,this.length),Cl(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||A(e,4,this.length),Cl(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||A(e,8,this.length),Cl(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||A(e,8,this.length),Cl(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){k(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){k(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigUInt64LE=Y((function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),o.prototype.writeBigUInt64BE=Y((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);k(this,e,t,r,n-1,-n)}let i=0,o=1,s=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);k(this,e,t,r,n-1,-n)}let i=r-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigInt64LE=Y((function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),o.prototype.writeBigInt64BE=Y((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),o.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return N(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return N(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const s=o.isBuffer(e)?e:o.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};const j={};function B(e,t,r){j[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function _(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function U(e,t,r,n,i,o){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=o>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(o+1)}${n}`:`>= -(2${n} ** ${8*(o+1)-1}${n}) and < 2 ** ${8*(o+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new j.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){F(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||V(t,e.length-(r+1))}(n,i,o)}function F(e,t){if("number"!=typeof e)throw new j.ERR_INVALID_ARG_TYPE(t,"number",e)}function V(e,t,r){if(Math.floor(e)!==e)throw F(e,r),new j.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new j.ERR_BUFFER_OUT_OF_BOUNDS;throw new j.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}B("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),B("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),B("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=_(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=_(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const z=/[^+/0-9A-Za-z-_]/g;function $(e,t){let r;t=t||1/0;const n=e.length;let i=null;const o=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function G(e){return Sl.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function W(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const H=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Y(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}})),Il=l((function(e,t){var r=El.Buffer;function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=El:(n(El,t),t.Buffer=i),i.prototype=Object.create(r.prototype),n(r,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return El.SlowBuffer(e)}})),Tl=l((function(e){var t=65536,r=4294967295;var n=Il.Buffer,i=u.crypto||u.msCrypto;i&&i.getRandomValues?e.exports=function(e,o){if(e>r)throw new RangeError("requested too many random bytes");var s=n.allocUnsafe(e);if(e>0)if(e>t)for(var a=0;a<e;a+=t)i.getRandomValues(s.slice(a,a+t));else i.getRandomValues(s);if("function"==typeof o)return process.nextTick((function(){o(null,s)}));return s}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}));class Rl{constructor(e,t){this.ufrag=e,this.pwd=t,this.lite=!1,this.endOfCandidates=!1}clone(){const e=new Rl(this.ufrag,this.pwd);return e.setLite(this.lite),e.setEndOfCandidates(this.endOfCandidates),e}plain(){const e={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(e.lite=this.lite),this.endOfCandidates&&(e.endOfCandidates=this.endOfCandidates),e}getUfrag(){return this.ufrag}getPwd(){return this.pwd}isLite(){return this.lite}setLite(e){this.lite=e}isEndOfCandidates(){return this.endOfCandidates}setEndOfCandidates(e){this.endOfCandidates=e}}Rl.generate=function(e){const t=new Rl,r=Tl(8),n=Tl(24);return t.ufrag=r.toString("hex"),t.pwd=n.toString("hex"),t.lite=e,t},Rl.expand=function(e){const t=new Rl(e.ufrag,e.pwd);return t.setLite(e.lite),t.setEndOfCandidates(e.endOfCandidates),t};var Pl=Rl;const Al=nl("SEND","RECV");Al.byValue=function(e){return Al[e.toUpperCase()]},Al.toString=function(e){switch(e){case Al.SEND:return"send";case Al.RECV:return"recv"}},Al.reverse=function(e){switch(e){case Al.SEND:return Al.RECV;case Al.RECV:return Al.SEND}};var kl=Al;class Ol{constructor(e,t){this.id=e,this.direction=t,this.formats=[],this.params=new Map}clone(){var e=new Ol(this.id,this.direction);return e.setFormats(this.formats),e.setParams(this.params),e}plain(){var e={id:this.id,direction:kl.toString(this.direction)};for(var[t,r]of(this.formats&&(e.formats=this.formats),this.params.entries()))e.params||(e.params={}),e.params[t]=r;return e}getId(){return this.id}getDirection(){return this.direction}setDirection(e){this.direction=e}getFormats(){return this.formats}setFormats(e){this.formats=[];for(let t=0;t<e.length;++t)this.formats.push(parseInt(e[t]))}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,t){this.params.set(e,t)}getDirection(){return this.direction}setDirection(e){this.direction=e}}Ol.expand=function(e){const t=new Ol(e.id,kl.byValue(e.direction));for(let r in e.params)t.addParam(r,e.params[r]);return e.formats&&t.setFormats(e.formats),t};var Ll=Ol;class Dl{constructor(e,t){this.paused=t,this.id=e}clone(){return new Dl(this.id,this.paused)}plain(){return{id:this.id,paused:this.paused}}isPaused(){return this.paused}getId(){return this.id}}Dl.expand=function(e){return new Dl(e.id,e.paused)};var Ml=Dl;class Nl{constructor(){this.send=[],this.recv=[]}clone(){const e=new Nl;for(let t=0;t<this.send.length;++t){let r=[];for(let e=0;t<this.send[e].length;++t)r.push(this.send[t][e].clone());e.addSimulcastAlternativeStreams(kl.SEND,r)}for(let t=0;t<this.recv.length;++t){let r=[];for(let e=0;t<this.recv[e].length;++t)r.push(this.recv[t][e].clone());e.addSimulcastAlternativeStreams(kl.RECV,r)}return e}plain(){const e={send:[],recv:[]};for(let t=0;t<this.send.length;++t){let r=[];for(let e=0;e<this.send[t].length;++e)r.push(this.send[t][e].plain());e.send.push(r)}for(let t=0;t<this.recv.length;++t){let r=[];for(let e=0;e<this.recv[t].length;++e)r.push(this.recv[t][e].plain());e.recv.push(r)}return e}addSimulcastAlternativeStreams(e,t){return e===kl.SEND?this.send.push(t):this.recv.push(t)}addSimulcastStream(e,t){return e===kl.SEND?this.send.push([t]):this.recv.push([t])}getSimulcastStreams(e){return e===kl.SEND?this.send:this.recv}}Nl.expand=function(e){const t=new Nl;for(let r=0;r<e.send.length;++r){let n=[];for(let t=0;t<e.send[r].length;++t)n.push(Ml.expand(e.send[r][t]));t.addSimulcastAlternativeStreams(kl.SEND,n)}for(let r=0;r<e.recv.length;++r){let n=[];for(let t=0;t<e.recv[r].length;++t)n.push(Ml.expand(e.recv[r][t]));t.addSimulcastAlternativeStreams(kl.RECV,n)}return t};var jl=Nl;const Bl=nl("SENDRECV","SENDONLY","RECVONLY","INACTIVE");Bl.byValue=function(e){return Bl[e.toUpperCase()]},Bl.toString=function(e){switch(e){case Bl.SENDRECV:return"sendrecv";case Bl.SENDONLY:return"sendonly";case Bl.RECVONLY:return"recvonly";case Bl.INACTIVE:return"inactive"}},Bl.reverse=function(e){switch(e){case Bl.SENDRECV:return Bl.SENDRECV;case Bl.SENDONLY:return Bl.RECVONLY;case Bl.RECVONLY:return Bl.SENDONLY;case Bl.INACTIVE:return Bl.INACTIVE}};var _l=Bl;class Ul{constructor(e,t){this.port=e,this.maxMessageSize=t}clone(){return new Ul(this.port,this.maxMessageSize)}plain(){return{port:this.port,maxMessageSize:this.maxMessageSize}}getPort(){return this.port}getMaxMessageSize(){return this.maxMessageSize}}Ul.expand=function(e){return new Ul(e.port,e.maxMessageSize)};var Fl=Ul;class Vl{constructor(e,t){this.id=e,this.type=t,this.direction=_l.SENDRECV,this.extensions=new Map,this.codecs=new Map,this.rids=new Map,this.simulcast=null,this.bitrate=0,this.control=null,this.dataChannel=null}clone(){const e=new Vl(this.id,this.type);e.setDirection(this.direction),e.setBitrate(this.bitrate);for(const t of this.codecs.values())e.addCodec(t.clone());for(const[t,r]of this.extensions.entries())e.addExtension(t,r);for(const t of this.rids.values())e.addRID(t.clone());return this.simulcast&&e.setSimulcast(this.simulcast.clone()),this.control&&e.setControl(this.control),this.dataChannel&&e.setDatachannel(this.dataChannel.clone()),e}plain(){const e={id:this.id,type:this.type,direction:_l.toString(this.direction),codecs:[]};this.dataChannel&&(e.dataChannel=this.dataChannel.plain()),this.bitrate&&(e.bitrate=this.bitrate);for(const t of this.codecs.values())e.codecs.push(t.plain());for(const[t,r]of this.extensions.entries())e.extensions||(e.extensions={}),e.extensions[t]=r;for(const t of this.rids.values())e.rids||(e.rids=[]),e.rids.push(t.plain());return this.simulcast&&(e.simulcast=this.simulcast.plain()),this.control&&(e.control=this.control),e}getType(){return this.type}getId(){return this.id}setId(e){this.id=e}addExtension(e,t){this.extensions.set(e,t)}addRID(e){this.rids.set(e.getId(),e)}addCodec(e){this.codecs.set(e.getType(),e)}setCodecs(e){this.codecs=e}getCodecForType(e){return this.codecs.get(e)}getCodec(e){for(const t of this.codecs.values())if(t.getCodec().toLowerCase()===e.toLowerCase())return t;return null}hasCodec(e){return null!==this.getCodec(e)}getCodecs(){return this.codecs}hasRTX(){for(const e of this.codecs.values())if(e.hasRTX())return!0;return!1}getExtensions(){return this.extensions}getRIDs(){return this.rids}getRID(e){return this.rids.get(e)}getBitrate(){return this.bitrate}setBitrate(e){this.bitrate=e}getDirection(){return this.direction}setDirection(e){this.direction=e}hasControl(){return!!this.control}getControl(){return this.control}setControl(e){this.control=e}hasDataChannel(){return!!this.dataChannel}getDataChannel(){return this.dataChannel}setDataChannel(e){this.dataChannel=e}answer(e){const t=new Vl(this.id,this.type);if(e){if(t.setDirection(_l.reverse(this.direction)),e.codecs){let r;r=Array.isArray(e.codecs)?rl.MapFromNames(e.codecs,e.rtx,e.rtcpfbs):e.codecs;for(let e of this.codecs.values())if(r.has(e.getCodec().toLowerCase())){const n=r.get(e.getCodec().toLowerCase());if("h264"===n.getCodec()&&n.hasParam("packetization-mode")&&n.getParam("packetization-mode")!=e.getParam("packetization-mode","0"))continue;if("h264"===n.getCodec()&&n.hasParam("profile-level-id")&&e.hasParam("profile-level-id")&&n.getParam("profile-level-id")!=e.getParam("profile-level-id"))continue;if("multiopus"===n.getCodec()&&n.hasParam("num_streams")&&e.hasParam("num_streams")&&n.getParam("num_streams")!=e.getParam("num_streams"))continue;const i=n.clone();i.setType(e.getType()),i.hasRTX()&&i.setRTX(e.getRTX()),e.hasChannels()&&i.setChannels(e.getChannels()),i.addParams(e.getParams()),t.addCodec(i)}}const n=new Set(e.extensions);for(let[e,r]of this.extensions)n.has(r)&&t.addExtension(e,r);if(e.simulcast&&this.simulcast){const e=new jl,n=this.simulcast.getSimulcastStreams(kl.SEND);if(n)for(let t=0;t<n.length;++t){var r=[];for(let e=0;e<n[t].length;++e)r.push(n[t][e].clone());e.addSimulcastAlternativeStreams(kl.RECV,r)}const i=this.simulcast.getSimulcastStreams(kl.RECV);if(i)for(let t=0;t<i.length;++t){r=[];for(let e=0;e<i[t].length;++e)r.push(i[t][e].clone());e.addSimulcastAlternativeStreams(kl.SEND,r)}for(const e of this.rids.values()){const r=e.clone();r.setDirection(kl.reverse(e.getDirection())),t.addRID(r)}t.setSimulcast(e)}if(e.dataChannel&&this.dataChannel){const r=new Fl(this.dataChannel.getPort(),e.dataChannel.maxMessageSize?e.dataChannel.maxMessageSize:this.dataChannel.getMaxMessageSize());t.setDataChannel(r)}}else t.setDirection(_l.INACTIVE);return t}getSimulcast(){return this.simulcast}setSimulcast(e){this.simulcast=e}}Vl.create=function(e,t){const r=new Vl(e,e);return t?t.codecs&&(Array.isArray(t.codecs)?r.setCodecs(rl.MapFromNames(t.codecs,t.rtx,t.rtcpfbs)):r.setCodecs(t.codecs)):r.setDirection(_l.INACTIVE),r},Vl.expand=function(e){const t=new Vl(e.id,e.type);if(e.direction&&t.setDirection(_l.byValue(e.direction)),t.setBitrate(e.bitrate),e.dataChannel){const r=Fl.expand(e.dataChannel);r&&t.setDataChannel(r)}for(let r in e.extensions)t.addExtension(r,e.extensions[r]);for(let r=0;e.codecs&&r<e.codecs.length;++r){const n=rl.expand(e.codecs[r]);n&&t.addCodec(n)}for(let r=0;e.rids&&r<e.rids.length;++r){const n=Ll.expand(e.rids[r]);t.addRID(n)}return e.simulcast&&t.setSimulcast(jl.expand(e.simulcast)),e.control&&t.setControl(e.control),t};var zl=Vl;class $l{constructor(e,t){this.semantics=e,this.ssrcs=[];for(let e=0;e<t.length;++e)this.ssrcs.push(parseInt(t[e]))}clone(){return new $l(this.semantics,this.ssrcs)}plain(){const e={semantics:this.semantics,ssrcs:[]};for(let t=0;t<this.ssrcs.length;++t)e.ssrcs.push(this.ssrcs[t]);return e}getSemantics(){return this.semantics}getSSRCs(){return this.ssrcs}}$l.expand=function(e){return new $l(e.semantics,e.ssrcs)};var Gl=$l;class ql{constructor(e){this.ssrc=e}clone(){const e=new ql(this.ssrc);e.setCName(this.cname),e.setStreamId(this.streamId),e.setTrackId(this.trackId)}plain(){const e={ssrc:this.ssrc};return this.cname&&(e.cname=this.cname),this.streamId&&(e.streamId=this.streamId),this.trackId&&(e.trackid=this.trackId),e}getCName(){return this.cname}setCName(e){this.cname=e}getStreamId(){return this.streamId}setStreamId(e){this.streamId=e}getTrackId(){return this.trackId}setTrackId(e){this.trackId=e}getSSRC(){return this.ssrc}}ql.expand=function(e){const t=new ql(e.ssrc);return t.setCName(e.cname),t.setStreamId(e.streamId),t.setTrackId(e.trackId),t};var Wl=ql;class Xl{constructor(e,t){this.id=e,this.paused=t,this.codecs=new Map,this.params=new Map}clone(){var e=new Xl(this.id,this.paused);for(let t of this.codecs.values())e.addCodec(t.clone());return e.setParams(this.params),e}plain(){var e={id:this.id,paused:this.paused,codecs:{},params:{}};for(var[t,r]of this.codecs.entries())e.codecs[t]=r.plain();for(var[t,n]of this.params.entries())e.params[t]=n;return e}getId(){return this.id}getCodecs(){return this.codecs}addCodec(e){this.codecs.set(e.getType(),e)}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,t){this.params.set(e,t)}isPaused(){return this.paused}}Xl.expand=function(e){const t=new Xl(e.id,e.paused);for(let r in e.codecs)t.addCodec(rl.expand(e.codecs[r]));for(let r in e.params)t.addParam(r,e.params[r]);return t};var Hl=Xl;class Yl{constructor(e,t){this.media=e,this.id=t,this.ssrcs=[],this.groups=[],this.encodings=[]}clone(){const e=new Yl(this.media,this.id);this.mediaId&&e.setMediaId(this.mediaId);for(let t=0;t<this.ssrcs.length;++t)e.addSSRC(this.ssrcs[t]);for(let t=0;t<this.groups.length;++t)e.addSourceGroup(this.groups[t].clone());for(let t=0;t<this.encodings.length;++t){const r=[];for(let e=0;e<this.encodings[t].length;++e)r.push(this.encodings[t][e].clone());e.addAlternativeEncodings(r)}return e}plain(){const e={media:this.media,id:this.id,ssrcs:[]};this.mediaId&&(e.mediaId=this.mediaId);for(let t=0;t<this.ssrcs.length;++t)e.ssrcs.push(this.ssrcs[t]);for(let t=0;t<this.groups.length;++t)e.groups||(e.groups=[]),e.groups.push(this.groups[t].plain());for(let t=0;t<this.encodings.length;++t){const r=[];for(let e=0;e<this.encodings[t].length;++e)r.push(this.encodings[t][e].plain());r.length&&(e.encodings||(e.encodings=[]),e.encodings.push(r))}return e}getMedia(){return this.media}setMediaId(e){this.mediaId=e}getMediaId(){return this.mediaId}getId(){return this.id}addSSRC(e){this.ssrcs.push(e)}getSSRCs(){return this.ssrcs}addSourceGroup(e){this.groups.push(e)}getSourceGroup(e){for(const t of this.groups)if(t.getSemantics().toLowerCase()===e.toLowerCase())return t;return null}getSourceGroups(){return this.groups}hasSourceGroup(e){for(const t of this.groups)if(t.getSemantics().toLowerCase()===e.toLowerCase())return!0;return!1}getEncodings(){return this.encodings}addEncoding(e){this.encodings.push([e])}addAlternativeEncodings(e){this.encodings.push(e)}setEncodings(e){this.encodings=e}}Yl.expand=function(e){const t=new Yl(e.media,e.id);e.mediaId&&t.setMediaId(e.mediaId);for(let r=0;e.ssrcs&&r<e.ssrcs.length;++r)t.addSSRC(e.ssrcs[r]);for(let r=0;e.groups&&r<e.groups.length;++r)t.addSourceGroup(Gl.expand(e.groups[r]));for(let r=0;e.encodings&&r<e.encodings.length;++r){const n=[];for(let t=0;t<e.encodings[r].length;++t)n.push(Hl.expand(e.encodings[r][t]));t.addAlternativeEncodings(n)}return t};var Jl=Yl;class Kl{constructor(e){this.id=e,this.tracks=new Map}clone(){const e=new Kl(this.id);for(const t of this.tracks.values())e.addTrack(t.clone());return e}plain(){const e={id:this.id,tracks:[]};for(const t of this.tracks.values())e.tracks.push(t.plain());return e}getId(){return this.id}addTrack(e){this.tracks.set(e.getId(),e)}removeTrack(e){return this.tracks.delete(e.getId())}removeTrackById(e){return this.tracks.delete(e)}getFirstTrack(e){for(let t of this.tracks.values())if(t.getMedia().toLowerCase()===e.toLowerCase())return t;return null}getTracks(){return this.tracks}removeAllTracks(){this.tracks.clear()}getTrack(e){return this.tracks.get(e)}}Kl.expand=function(e){const t=new Kl(e.id,e.paused);for(let r=0;r<e.tracks.length;++r){const n=Jl.expand(e.tracks[r]);n&&t.addTrack(n)}return t};var Zl=Kl;class Ql{constructor(e){this.version=e||1,this.streams=new Map,this.medias=new Array,this.candidates=new Array,this.ice=null,this.dtls=null,this.crypto=null,this.extmapAllowMixed=!0}clone(){const e=new Ql(this.version);for(let t=0;t<this.medias.length;++t)e.addMedia(this.medias[t].clone());for(const t of this.streams.values())e.addStream(t.clone());for(let t=0;t<this.candidates.length;++t)e.addCandidate(this.candidates[t].clone());return e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e.setExmapAllowMixed(this.extmapAllowMixed),e}plain(){const e={version:this.version,streams:[],medias:[],candidates:[]};for(let t=0;t<this.medias.length;++t)e.medias.push(this.medias[t].plain());for(const t of this.streams.values())e.streams.push(t.plain());for(let t=0;t<this.candidates.length;++t)e.candidates.push(this.candidates[t].plain());return this.ice&&(e.ice=this.ice.plain()),this.dtls&&(e.dtls=this.dtls.plain()),this.crypto&&(e.crypto=this.crypto.plain()),this.extmapAllowMixed||(e.extmapAllowMixedNotSupported=!this.extmapAllowMixed),e}unify(){const e=new Ql(this.version);for(let t=0;t<this.medias.length;++t)e.addMedia(this.medias[t].clone());const t={audio:e.getMediasByType("audio"),video:e.getMediasByType("video")};for(const r of this.streams.values()){const n=r.clone();for(const r of n.getTracks().values()){let n=t[r.getMedia()].pop();if(!n){n=this.getMedia(r.getMedia()).clone(),n.setId(r.getId()),e.addMedia(n)}r.setMediaId(n.getId())}e.addStream(n)}for(let t=0;t<this.candidates.length;++t)e.addCandidate(this.candidates[t].clone());return this.ice&&e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e}setVersion(e){this.version=e}addMedia(e){this.medias.push(e)}getMedia(e){for(let t in this.medias){let r=this.medias[t];if(r.getType().toLowerCase()===e.toLowerCase())return r}return null}getMediasByType(e){var t=[];for(let r in this.medias){let n=this.medias[r];n.getType().toLowerCase()===e.toLowerCase()&&t.push(n)}return t}getMediaById(e){for(let t in this.medias){let r=this.medias[t];if(r.getId().toLowerCase()===e.toLowerCase())return r}return null}replaceMedia(e){for(let t in this.medias)if(this.medias[t].getId()==e.getId())return this.medias[t]=e,!0;return!1}getMedias(){return this.medias}getVersion(){return this.version}getDTLS(){return this.dtls}setDTLS(e){this.dtls=e}hasCrypto(){return!!this.crypto}getCrypto(){return this.crypto}setCrypto(e){this.crypto=e}hasICE(){return!!this.ice}getICE(){return this.ice}setICE(e){this.ice=e}addCandidate(e){for(let t=0;t<this.candidates.length;++t)if(this.candidates[t].equals(e))return;this.candidates.push(e)}addCandidates(e){for(let t=0;t<e.length;++t)this.addCandidate(e[t])}getCandidates(){return this.candidates}getStream(e){return this.streams.get(e)}getStreams(){return this.streams}getFirstStream(){for(let e of this.streams.values())return e;return null}addStream(e){this.streams.set(e.getId(),e)}removeStream(e){return this.streams.delete(e.getId())}removeAllStreams(){this.streams.clear()}getTrackByMediaId(e){for(let t of this.streams.values())for(let[r,n]of t.getTracks())if(n.getMediaId()==e)return n;return null}getStreamByMediaId(e){for(let t of this.streams.values())for(let[r,n]of t.getTracks())if(n.getMediaId()==e)return t;return null}getExtmapAllowMixed(){return this.extmapAllowMixed}setExtmapAllowMixed(e){this.extmapAllowMixed=e}answer(e){const t=new Ql;e.ice&&(e.ice instanceof Pl?t.setICE(e.ice.clone()):t.setICE(Pl.expand(e.ice))),e.dtls&&(e.dtls instanceof al?t.setDTLS(e.dtls):t.setDTLS(al.expand(e.dtls))),e.crypto&&(e.crypto instanceof ul?t.setCrypto(e.crypto):t.setCrypto(ul.expand(e.crypto)));for(let r=0;e.candidates&&r<e.candidates.length;++r)e.candidates[r]instanceof Zu?t.addCandidate(e.candidates[r].clone()):t.addCandidate(Zu.expand(e.candidates[r]));for(const r of this.medias){const n=e&&e.capabilities&&e.capabilities[r.getType()];t.addMedia(r.answer(n))}return t.setExtmapAllowMixed(this.extmapAllowMixed),t}toString(){let e={version:0,media:[]};e.version=0,e.origin={username:"-",sessionId:(new Date).getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"},e.name="semantic-sdp",e.connection={version:4,ip:"0.0.0.0"},e.timing={start:0,stop:0},this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),e.msidSemantic={semantic:"WMS",token:"*"},e.groups=[],this.extmapAllowMixed&&(e.extmapAllowMixed="extmap-allow-mixed");let t={type:"BUNDLE",mids:[]};for(let r in this.medias){let n=this.medias[r],i={type:n.getType(),port:9,protocol:"",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};i.direction=_l.toString(n.getDirection()),this.extmapAllowMixed&&(i.extmapAllowMixed="extmap-allow-mixed"),i.mid=n.getId(),t.mids.push(n.getId()),n.hasControl()&&(i.control=n.getControl()),n.getBitrate()>0&&(i.bandwidth.push({type:"AS",limit:n.getBitrate()}),i.bandwidth.push({type:"TIAS",limit:1e3*n.getBitrate()}));let o=this.getCandidates();for(let e=0;e<o.length;++e){let t=o[e];i.candidates.push({foundation:t.getFoundation(),component:t.getComponentId(),transport:t.getTransport(),priority:t.getPriority(),ip:t.getAddress(),port:t.getPort(),type:t.getType(),raddr:t.getRelAddr(),rport:t.getRelPort()})}if(this.getICE()&&(i.iceUfrag=this.getICE().getUfrag(),i.icePwd=this.getICE().getPwd()),["audio","video"].includes(n.getType().toLowerCase())){i.rtcpMux="rtcp-mux",i.rtcpRsize="rtcp-rsize",this.getDTLS()?(i.protocol="UDP/TLS/RTP/SAVPF",i.fingerprint={type:this.getDTLS().getHash(),hash:this.getDTLS().getFingerprint()},i.setup=ol.toString(this.getDTLS().getSetup())):this.getCrypto()?(i.protocol="RTP/SAVPF",i.crypto=[{id:this.getCrypto().getTag(),suite:this.getCrypto().getSuite(),config:this.getCrypto().getKeyParams()}]):i.protocol="RTP/AVP";for(let e of n.getCodecs().values()){"video"===n.getType().toLowerCase()?i.rtp.push({payload:e.getType(),codec:e.getCodec().toUpperCase(),rate:9e4}):"opus"===e.getCodec().toLowerCase()||"multiopus"===e.getCodec().toLowerCase()?i.rtp.push({payload:e.getType(),codec:e.getCodec(),rate:48e3,encoding:e.getChannels()}):i.rtp.push({payload:e.getType(),codec:e.getCodec(),rate:8e3});for(const t of e.getRTCPFeedbacks())i.rtcpFb.push({payload:e.getType(),type:t.getId(),subtype:t.getParams().join(" ")});e.hasRTX()&&(i.rtp.push({payload:e.getRTX(),codec:"rtx",rate:9e4}),i.fmtp.push({payload:e.getRTX(),config:"apt="+e.getType()}));const t=e.getParams();if(Object.keys(t).length){const r={payload:e.getType(),config:""};for(const e in t)r.config.length&&(r.config+=";"),t.hasOwnProperty(e)?r.config+=e+"="+t[e]:r.config+=e;i.fmtp.push(r)}}const e=[];for(let t=0;t<i.rtp.length;++t)e.push(i.rtp[t].payload);i.payloads=e.join(" ");for(let[e,t]of n.getExtensions().entries())i.ext.push({value:e,uri:t});for(let e of n.getRIDs().values()){let t={id:e.getId(),direction:kl.toString(e.getDirection()),params:""};e.getFormats().length&&(t.params="pt="+e.getFormats().join(","));for(let[r,n]of e.getParams().entries())t.params+=(t.params.length?";":"")+r+"="+n;i.rids.push(t)}const t=n.getSimulcast();if(t){let e=1;i.simulcast={};const r=t.getSimulcastStreams(kl.SEND),n=t.getSimulcastStreams(kl.RECV);if(r&&r.length){let t="";for(let e=0;e<r.length;++e){let n="";for(let t=0;t<r[e].length;++t)n+=(n.length?",":"")+(r[e][t].isPaused()?"~":"")+r[e][t].getId();t+=(t.length?";":"")+n}i.simulcast["dir"+e]="send",i.simulcast["list"+e]=t,e++}if(n&&n.length){let t=[];for(let e=0;e<n.length;++e){let r="";for(let t=0;t<n[e].length;++t)r+=(r.length?",":"")+(n[e][t].isPaused()?"~":"")+n[e][t].getId();t+=(t.length?";":"")+r}i.simulcast["dir"+e]="recv",i.simulcast["list"+e]=t,e++}}}else if(n.hasDataChannel()){i.protocol="UDP/DTLS/SCTP",i.payloads="webrtc-datachannel";const e=n.getDataChannel();i.sctpPort=e.getPort(),i.maxMessageSize=e.getMaxMessageSize()}e.media.push(i)}for(let t of this.streams.values())for(let r of t.getTracks().values())for(let n in e.media){let i=e.media[n];if(r.getMediaId()){if(r.getMediaId()==i.mid){let e=r.getSourceGroups();for(let t in e){let r=e[t];i.ssrcGroups.push({semantics:r.getSemantics(),ssrcs:r.getSSRCs().join(" ")})}let n=r.getSSRCs();for(let e in n)i.ssrcs.push({id:n[e],attribute:"cname",value:t.getId()}),i.ssrcs.push({id:n[e],attribute:"msid",value:t.getId()+" "+r.getId()});i.msid=t.getId()+" "+r.getId();break}}else if(i.type.toLowerCase()===r.getMedia().toLowerCase()){let e=r.getSourceGroups();for(let t in e){let r=e[t];i.ssrcGroups.push({semantics:r.getSemantics(),ssrcs:r.getSSRCs().join(" ")})}let n=r.getSSRCs();for(let e in n)i.ssrcs.push({id:n[e],attribute:"cname",value:t.getId()}),i.ssrcs.push({id:n[e],attribute:"msid",value:t.getId()+" "+r.getId()});break}}return t.mids=t.mids.join(" "),e.groups.push(t),Ju.write(e)}toIceFragmentString(){let e={version:0,media:[],candidates:[]};this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),this.getICE()&&(e.iceUfrag=this.getICE().getUfrag(),e.icePwd=this.getICE().getPwd());for(const t of this.getCandidates())e.candidates.push({foundation:t.getFoundation(),component:t.getComponentId(),transport:t.getTransport(),priority:t.getPriority(),ip:t.getAddress(),port:t.getPort(),type:t.getType(),raddr:t.getRelAddr(),rport:t.getRelPort()});return Ju.write(e).slice(10)}}Ql.create=function(e){const t=new Ql;e.ice&&(e.ice instanceof Pl?t.setICE(e.ice.clone()):t.setICE(Pl.expand(e.ice))),e.dtls&&(e.dtls instanceof al?t.setDTLS(e.dtls):t.setDTLS(al.expand(e.dtls))),e.crypto&&(e.crypto instanceof ul?t.setCrypto(e.crypto):t.setCrypto(ul.expand(e.crypto)));for(let r=0;e.candidates&&r<e.candidates.length;++r)e.candidates[r]instanceof Zu?t.addCandidate(e.candidates[r].clone()):t.addCandidate(Zu.expand(e.candidates[r]));let r=96,n=1;for(let i in e.capabilities){const o=zl.create(i,e.capabilities[i]);for(const[e,t]of o.getCodecs())t.getType()>=96&&t.setType(r++),t.getRTX()&&t.setRTX(r++);if(e.capabilities[i].extensions)for(let t of e.capabilities[i].extensions)15===n&&n++,o.addExtension(n++,t);t.addMedia(o)}return t},Ql.expand=function(e){const t=new Ql(e.version);for(let r=0;e.medias&&r<e.medias.length;++r){const n=zl.expand(e.medias[r]);n&&t.addMedia(n)}for(let r=0;e.streams&&r<e.streams.length;++r){const n=Zl.expand(e.streams[r]);n&&t.addStream(n)}for(let r=0;e.candidates&&r<e.candidates.length;++r){const n=Zu.expand(e.candidates[r]);n&&t.addCandidate(n)}return e.ice&&t.setICE(Pl.expand(e.ice)),e.dtls&&t.setDTLS(al.expand(e.dtls)),e.crypto&&t.setCrypto(al.expand(e.crypto)),e.extmapAllowMixedNotSupported&&(this.extmapAllowMixed=!e.extmapAllowMixedNotSupported),t},Ql.process=function(e){return Ql.parse(e)},Ql.parse=function(e){const t=Ju.parse(e),r=new Ql;if(r.setVersion(t.version),t.iceUfrag&&t.icePwd){const e=String(t.iceUfrag),n=String(t.icePwd),i=new Pl(e,n);i.setLite("ice-lite"==t.icelite),i.setEndOfCandidates("end-of-candidates"==t.endOfCandidates),r.setICE(i)}for(let e in t.media){const n=t.media[e],i=n.type,o=n.mid?n.mid.toString():e,s=new zl(o,i);if(n.iceUfrag&&n.icePwd){const e=String(n.iceUfrag),i=String(n.icePwd),o=new Pl(e,i);o.setLite("ice-lite"==t.icelite),o.setEndOfCandidates("end-of-candidates"==n.endOfCandidates),r.setICE(o)}for(let e=0;n.candidates&&e<n.candidates.length;++e){const t=n.candidates[e],i=new Zu(t.foundation,t.component,t.transport,t.priority,t.ip,t.port,t.type,t.raddr,t.rport);r.addCandidate(i)}const a=n.fingerprint||t.fingerprint;if(a){const e=a.type,t=a.hash;let i=ol.ACTPASS;n.setup&&(i=ol.byValue(n.setup)),r.setDTLS(new al(i,e,t))}if(n.crypto){const e=n.crypto[0];r.setCrypto(new ul(e.id,e.suite,e.config,e.sessionConfig))}let c=_l.SENDRECV;n.direction&&(c=_l.byValue(n.direction),s.setDirection(c)),n.control&&s.setControl(n.control),r.setExtmapAllowMixed("extmap-allow-mixed"==n.extmapAllowMixed||"extmap-allow-mixed"==t.extmapAllowMixed);const u=new Map;for(let e in n.rtp){const t=n.rtp[e],r=t.payload,i=t.codec;if("RED"===i.toUpperCase()||"ULPFEC"===i.toUpperCase())continue;let o={};for(let e in n.fmtp){const t=n.fmtp[e];if(t.payload===r){const e=t.config.split(";");for(let t in e){const r=e[t].split("="),n=r[0].trim(),i=r.splice(1).join("=").trim();o[n]=i}}}if("RTX"===i.toUpperCase())u.set(parseInt(o.apt),r);else{const e=new rl(i,r,o);t.encoding>1&&e.setChannels(t.encoding),s.addCodec(e)}}for(let e of u.entries()){const t=s.getCodecForType(e[0]);t&&t.setRTX(e[1])}for(let e=0;n.rtcpFb&&e<n.rtcpFb.length;++e){const t=s.getCodecForType(n.rtcpFb[e].payload);if(t){const r=n.rtcpFb[e].type,i=n.rtcpFb[e].subtype?n.rtcpFb[e].subtype.split(" "):null;t.addRTCPFeedback(new el(r,i))}}const l=n.ext;for(let e in l){const t=l[e];s.addExtension(t.value,t.uri)}const d=n.rids;for(let e in d){const t=d[e],r=new Ll(t.id,kl.byValue(t.direction));let n=[];const i=new Map;if(t.params){const e=Ju.parseParams(t.params);for(let t in e)"pt"===t?n=e[t].split(","):i.set(t,e[t]);r.setFormats(n),r.setParams(i)}s.addRID(r)}const f=[];if(n.simulcast){const e=new jl;if(n.simulcast.dir1){const t=kl.byValue(n.simulcast.dir1),r=Ju.parseSimulcastStreamList(n.simulcast.list1);for(let n=0;n<r.length;++n){const i=[];for(let e=0;e<r[n].length;++e)i.push(new Ml(r[n][e].scid,r[n][e].paused));e.addSimulcastAlternativeStreams(t,i)}}if(n.simulcast.dir2){const t=kl.byValue(n.simulcast.dir2),r=Ju.parseSimulcastStreamList(n.simulcast.list2);for(let n=0;n<r.length;++n){const i=[];for(let e=0;e<r[n].length;++e)i.push(new Ml(r[n][e].scid,r[n][e].paused));e.addSimulcastAlternativeStreams(t,i)}}for(let t of e.getSimulcastStreams(kl.SEND)){const e=[];for(let r=0;r<t.length;r++){const n=new Hl(t[r].getId(),t[r].isPaused()),i=s.getRID(n.getId());if(i){const t=i.getFormats();for(let e=0;t&&e<t.length;++e){const r=s.getCodecForType(t[e]);r&&n.addCodec(r)}n.setParams(i.getParams()),e.push(n)}}e.length&&f.push(e)}s.setSimulcast(e)}const p=new Map;if(n.ssrcs)for(let e in n.ssrcs){let t=n.ssrcs[e],s=t.id,a=t.attribute,c=t.value,u=p.get(s);if(u||(u=new Wl(s),p.set(u.getSSRC(),u)),"cname"===a.toLowerCase())u.setCName(c);else if("msid"===a.toLowerCase()){let e=c.split(" "),t=e[0],n=e[1];u.setStreamId(t),u.setTrackId(n);let a=r.getStream(t);a||(a=new Zl(t),r.addStream(a));let l=a.getTrack(n);l||(l=new Jl(i,n),l.setMediaId(o),l.setEncodings(f),a.addTrack(l)),l.addSSRC(s)}}if(n.msid){let e=n.msid.split(" "),t=e[0],s=e[1],a=r.getStream(t);a||(a=new Zl(t),r.addStream(a));let c=a.getTrack(s);c||(c=new Jl(i,s),c.setMediaId(o),c.setEncodings(f),a.addTrack(c));for(let[e,r]of p.entries())r.getStreamId()||(r.setStreamId(t),r.setTrackId(s),c.addSSRC(e))}for(let[e,t]of p.entries())if(!t.getStreamId()){let n=t.getCName(),s=o;t.setStreamId(n),t.setTrackId(s);let a=r.getStream(n);a||(a=new Zl(n),r.addStream(a));let c=a.getTrack(s);c||(c=new Jl(i,s),c.setMediaId(o),c.setEncodings(f),a.addTrack(c)),c.addSSRC(e)}if(n.ssrcGroups)for(let e in n.ssrcGroups){let t=n.ssrcGroups[e],i=t.ssrcs.split(" "),o=new Gl(t.semantics,i),s=p.get(parseInt(i[0]));s&&r.getStream(s.getStreamId()).getTrack(s.getTrackId()).addSourceGroup(o)}if("application"==n.type&&"webrtc-datachannel"==n.payloads){const e=new Fl(n.sctpPort,n.maxMessageSize);s.setDataChannel(e)}r.addMedia(s)}return r};var ed,td,rd={SDPInfo:Ql,CandidateInfo:Zu,CodecInfo:rl,DTLSInfo:al,CryptoInfo:ul,ICEInfo:Pl,MediaInfo:zl,Setup:ol,SourceGroupInfo:Gl,SourceInfo:Wl,StreamInfo:Zl,TrackInfo:Jl,RTCPFeedbackInfo:el,TrackEncodingInfo:Hl,Direction:_l},nd=(ed=!1,(td=/[ac]/).exec=function(){return ed=!0,/./.exec.apply(this,arguments)},!0===td.test("abc")&&ed),id=/./.test;Ht({target:"RegExp",proto:!0,forced:!nd},{test:function(e){var t=ze(this),r=To(e),n=t.exec;if(!G(n))return b(id,t,r);var i=b(n,t,r);return null!==i&&(ze(i),!0)}});var od=l((function(e,t){!function(r,n){var i="function",o="undefined",s="object",a="string",c="model",u="name",l="type",d="vendor",f="version",p="architecture",h="console",g="mobile",m="tablet",v="smarttv",y="wearable",b="embedded",w="Amazon",S="Apple",C="ASUS",x="BlackBerry",E="Firefox",I="Google",T="Huawei",R="LG",P="Microsoft",A="Motorola",k="Opera",O="Samsung",L="Sony",D="Xiaomi",M="Zebra",N="Facebook",j=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},B=function(e,t){return typeof e===a&&-1!==_(t).indexOf(_(e))},_=function(e){return e.toLowerCase()},U=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===o?e:e.substring(0,255)},F=function(e,t){for(var r,o,a,c,u,l,d=0;d<t.length&&!u;){var f=t[d],p=t[d+1];for(r=o=0;r<f.length&&!u;)if(u=f[r++].exec(e))for(a=0;a<p.length;a++)l=u[++o],typeof(c=p[a])===s&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):n:this[c[0]]=l?c[1].call(this,l,c[2]):n:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):n):this[c]=l||n;d+=2}},V=function(e,t){for(var r in t)if(typeof t[r]===s&&t[r].length>0){for(var i=0;i<t[r].length;i++)if(B(t[r][i],e))return"?"===r?n:r}else if(B(t[r],e))return"?"===r?n:r;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},$={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,f],[/opios[\/ ]+([\w\.]+)/i],[f,[u,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[f,[u,k]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[u,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[f,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[f,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure Browser"],f],[/\bfocus\/([\w\.]+)/i],[f,[u,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[f,[u,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[u,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[u,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[f,[u,E]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 Browser"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,N],f],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,"Chrome WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,f],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[f,[u,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[f,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[f,V,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[u,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,_]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",_]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,_]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[d,O],[l,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[d,O],[l,g]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[d,S],[l,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[d,S],[l,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[d,T],[l,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[c,[d,T],[l,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[d,D],[l,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[d,D],[l,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[d,"OPPO"],[l,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[d,"Vivo"],[l,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[d,"Realme"],[l,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[d,A],[l,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[d,A],[l,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[d,R],[l,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[d,R],[l,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[d,"Lenovo"],[l,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[d,"Nokia"],[l,g]],[/(pixel c)\b/i],[c,[d,I],[l,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[d,I],[l,g]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[d,L],[l,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[d,L],[l,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[d,"OnePlus"],[l,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[d,w],[l,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[d,w],[l,g]],[/(playbook);[-\w\),; ]+(rim)/i],[c,d,[l,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[d,x],[l,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[d,C],[l,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[d,C],[l,g]],[/(nexus 9)/i],[c,[d,"HTC"],[l,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[d,[c,/_/g," "],[l,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[d,"Acer"],[l,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[d,"Meizu"],[l,g]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[d,"Sharp"],[l,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,c,[l,g]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,c,[l,m]],[/(surface duo)/i],[c,[d,P],[l,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[d,"Fairphone"],[l,g]],[/(u304aa)/i],[c,[d,"AT&T"],[l,g]],[/\bsie-(\w*)/i],[c,[d,"Siemens"],[l,g]],[/\b(rct\w+) b/i],[c,[d,"RCA"],[l,m]],[/\b(venue[\d ]{2,7}) b/i],[c,[d,"Dell"],[l,m]],[/\b(q(?:mv|ta)\w+) b/i],[c,[d,"Verizon"],[l,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[d,"Barnes & Noble"],[l,m]],[/\b(tm\d{3}\w+) b/i],[c,[d,"NuVision"],[l,m]],[/\b(k88) b/i],[c,[d,"ZTE"],[l,m]],[/\b(nx\d{3}j) b/i],[c,[d,"ZTE"],[l,g]],[/\b(gen\d{3}) b.+49h/i],[c,[d,"Swiss"],[l,g]],[/\b(zur\d{3}) b/i],[c,[d,"Swiss"],[l,m]],[/\b((zeki)?tb.*\b) b/i],[c,[d,"Zeki"],[l,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],c,[l,m]],[/\b(ns-?\w{0,9}) b/i],[c,[d,"Insignia"],[l,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[d,"NextBook"],[l,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],c,[l,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],c,[l,g]],[/\b(ph-1) /i],[c,[d,"Essential"],[l,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[d,"Envizen"],[l,m]],[/\b(trio[-\w\. ]+) b/i],[c,[d,"MachSpeed"],[l,m]],[/\btu_(1491) b/i],[c,[d,"Rotor"],[l,m]],[/(shield[\w ]+) b/i],[c,[d,"Nvidia"],[l,m]],[/(sprint) (\w+)/i],[d,c,[l,g]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[d,P],[l,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[d,M],[l,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[d,M],[l,g]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,c,[l,h]],[/droid.+; (shield) bui/i],[c,[d,"Nvidia"],[l,h]],[/(playstation [345portablevi]+)/i],[c,[d,L],[l,h]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[d,P],[l,h]],[/smart-tv.+(samsung)/i],[d,[l,v]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[d,O],[l,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,R],[l,v]],[/(apple) ?tv/i],[d,[c,"Apple TV"],[l,v]],[/crkey/i],[[c,"Chromecast"],[d,I],[l,v]],[/droid.+aft(\w)( bui|\))/i],[c,[d,w],[l,v]],[/\(dtv[\);].+(aquos)/i],[c,[d,"Sharp"],[l,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[d,U],[c,U],[l,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,v]],[/((pebble))app/i],[d,c,[l,y]],[/droid.+; (glass) \d/i],[c,[d,I],[l,y]],[/droid.+; (wt63?0{2,3})\)/i],[c,[d,M],[l,y]],[/(quest( 2)?)/i],[c,[d,N],[l,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[l,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[l,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[l,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,m]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[l,g]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[f,V,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[f,V,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[f,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,f],[/\(bb(10);/i],[f,[u,x]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[u,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[u,"webOS"]],[/crkey\/([\d\.]+)/i],[f,[u,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[u,"Chromium OS"],f],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,f],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,f]]},G=function(e,t){if(typeof e===s&&(t=e,e=n),!(this instanceof G))return new G(e,t).getResult();var i=e||(typeof r!==o&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),c=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}($,t):$;return this.getBrowser=function(){var e={};return e.name=n,e.version=n,F.call(e,i,c.browser),e.major=function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:n}(e.version),e},this.getCPU=function(){var e={};return e.architecture=n,F.call(e,i,c.cpu),e},this.getDevice=function(){var e={};return e.vendor=n,e.model=n,e.type=n,F.call(e,i,c.device),e},this.getEngine=function(){var e={};return e.name=n,e.version=n,F.call(e,i,c.engine),e},this.getOS=function(){var e={};return e.name=n,e.version=n,F.call(e,i,c.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===a&&e.length>255?U(e,255):e,this},this.setUA(i),this};G.VERSION="0.7.31",G.BROWSER=j([u,f,"major"]),G.CPU=j([p]),G.DEVICE=j([c,d,l,h,g,v,m,y,b]),G.ENGINE=G.OS=j([u,f]),e.exports&&(t=e.exports=G),t.UAParser=G;var q=typeof r!==o&&(r.jQuery||r.Zepto);if(q&&!q.ua){var W=new G;q.ua=W.getResult(),q.ua.get=function(){return W.getUA()},q.ua.set=function(e){W.setUA(e);var t=W.getResult();for(var r in t)q.ua[r]=t[r]}}}("object"==typeof window?window:u)}));const sd=["iOS"];class ad extends od{constructor(){super(window.navigator.userAgent)}isChrome(){const e=this.getBrowser();if(!e.name)return!1;const t=this.getOS();let r=!0;return r=!new RegExp(sd.join("|"),"i").test(t.name),e.name.match(/Chrome/i)&&r}isFirefox(){const e=this.getBrowser();return!!e.name&&e.name.match(/Firefox/i)}}const cd=cn.get("SdpParser"),ud=Array.from({length:31},((e,t)=>t+35)),ld=Array.from({length:32},((e,t)=>t+96)),dd=Array.from({length:14},((e,t)=>t+1)),fd=Array.from({length:240},((e,t)=>t+16));class pd{static setSimulcast(e,t){cd.info("Setting simulcast. Codec: ",t);if(!(new ad).isChrome())return cd.warn("Simulcast is only available in Google Chrome browser"),e;if("h264"!==t&&"vp8"!==t)return cd.warn("Simulcast is only available in h264 and vp8 codecs"),e;try{const t=/m=video[\s\S]*?a=ssrc:(\d*) msid:([\s\S]+?)\r\n/,r=/m=video[\s\S]*?a=ssrc:(\d*) cname:([\s\S]+?)\r\n/.exec(e),n=r[1],i=r[2],o=t.exec(e)[2],s=2,a=[n];for(let t=0;t<s;++t){const r=100+2*t,n=r+1;a.push(r),e+="a=ssrc-group:FID "+r+" "+n+"\r\na=ssrc:"+r+" cname:"+i+"\r\na=ssrc:"+r+" msid:"+o+"\r\na=ssrc:"+n+" cname:"+i+"\r\na=ssrc:"+n+" msid:"+o+"\r\n"}return e+="a=ssrc-group:SIM "+a.join(" ")+"\r\n",cd.info("Simulcast setted"),cd.debug("Simulcast SDP: ",e),e}catch(e){throw cd.error("Error setting SDP for simulcast: ",e),e}}static setStereo(e){return cd.info("Replacing SDP response for support stereo"),e=e.replace(/useinbandfec=1/g,"useinbandfec=1; stereo=1"),cd.info("Replaced SDP response for support stereo"),cd.debug("New SDP value: ",e),e}static setDTX(e){return cd.info("Replacing SDP response for support dtx"),e=e.replace("useinbandfec=1","useinbandfec=1; usedtx=1"),cd.info("Replaced SDP response for support dtx"),cd.debug("New SDP value: ",e),e}static setAbsoluteCaptureTime(e){const t="a=extmap:"+pd.getAvailableHeaderExtensionIdRange(e)[0]+" http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time\r\n";return e=e.replace(/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm,((e,r,n)=>r+t+n)),cd.info("Replaced SDP response for setting absolute capture time"),cd.debug("New SDP value: ",e),e}static setDependencyDescriptor(e){const t="a=extmap:"+pd.getAvailableHeaderExtensionIdRange(e)[0]+" https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension\r\n";return e=e.replace(/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm,((e,r,n)=>r+t+n)),cd.info("Replaced SDP response for setting depency descriptor"),cd.debug("New SDP value: ",e),e}static setVideoBitrate(e,t){if(t<1)cd.info("Remove bitrate restrictions"),e=e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");else{const r=rd.SDPInfo.parse(e),n=r.getMedia("video");cd.info("Setting video bitrate"),n.setBitrate(t),e=r.toString()}return e}static removeSdpLine(e,t){return cd.debug("SDP before trimming: ",e),e=e.split("\n").filter((e=>e.trim()!==t)).join("\n"),cd.debug("SDP trimmed result: ",e),e}static adaptCodecName(e,t,r){if(!e)return e;const n=new RegExp("".concat(t),"i");return e.replace(n,r)}static setMultiopus(e,t){if(!(new ad).isFirefox()&&(!t||hd(t)))if(e.includes("multiopus/48000/6"))cd.info("Multiopus already setted");else{cd.info("Setting multiopus");const t=/m=audio 9 UDP\/TLS\/RTP\/SAVPF (.*)\r\n/.exec(e)[0],r=pd.getAvailablePayloadTypeRange(e)[0],n=t.replace("\r\n"," ")+r+"\r\na=rtpmap:"+r+" multiopus/48000/6\r\na=fmtp:"+r+" channel_mapping=0,4,1,2,3,5;coupled_streams=2;minptime=10;num_streams=4;useinbandfec=1\r\n";e=e.replace(t,n),cd.info("Multiopus offer created"),cd.debug("SDP parsed for multioups: ",e)}return e}static getAvailablePayloadTypeRange(e){const t=e.matchAll(/m=(?:.*) (?:.*) UDP\/TLS\/RTP\/SAVPF (.*)\r\n/gm);let r=ld.concat(ud);var n,i=c(t);try{for(i.s();!(n=i.n()).done;){const e=n.value[1].split(" ").map((e=>parseInt(e)));r=r.filter((t=>!e.includes(t)))}}catch(e){i.e(e)}finally{i.f()}return r}static getAvailableHeaderExtensionIdRange(e){const t=e.matchAll(/a=extmap:(\d+)(?:.*)\r\n/gm);let r=dd.concat(fd);var n,i=c(t);try{for(i.s();!(n=i.n()).done;){const e=n.value[1].split(" ").map((e=>parseInt(e)));r=r.filter((t=>!e.includes(t)))}}catch(e){i.e(e)}finally{i.f()}return r}static renegotiate(e,t){const r=rd.SDPInfo.parse(e),n=rd.SDPInfo.parse(t);var i,s=c(r.getMedias());try{for(s.s();!(i=s.n()).done;){const e=i.value;let t=n.getMediaById(e.getId());if(!t){t=new rd.MediaInfo(e.getId(),e.getType()),t.setDirection(rd.Direction.reverse(e.getDirection()));const r=n.getMedia(e.getType());if(r){t.setCodecs(r.getCodecs());var a,u=c(r.getExtensions());try{for(u.s();!(a=u.n()).done;){const e=o(a.value,2),r=e[0],n=e[1];t.addExtension(r,n)}}catch(e){u.e(e)}finally{u.f()}}n.addMedia(t)}}}catch(e){s.e(e)}finally{s.f()}return n.toString()}static updateMissingVideoExtensions(e,t){var r;const n=rd.SDPInfo.parse(e),i=null===(r=rd.SDPInfo.parse(t).getMediasByType("video")[0])||void 0===r?void 0:r.getExtensions();if(i||i.length){var o,s=c(n.getMediasByType("video"));try{for(s.s();!(o=s.n()).done;){const t=o.value,r=t.getExtensions();i.forEach(((n,i)=>{if(!r.get(i)){const r=t.getId(),o="a=extmap:"+i+" "+n+"\r\n",s=new RegExp("(a=mid:"+r+"\r\n(?:.*\r\n)*?)","g");e=e.replace(s,((e,t,r)=>t+o))}}))}}catch(e){s.e(e)}finally{s.f()}return e}}}const hd=e=>e.getAudioTracks().some((e=>e.getSettings().channelCount>2));var gd=At.indexOf,md=A([].indexOf),vd=!!md&&1/md([1],1,-0)<0,yd=function(e,t){var r=[][e];return!!r&&g((function(){r.call(null,t||function(){return 1},1)}))}("indexOf");Ht({target:"Array",proto:!0,forced:vd||!yd},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return vd?md(this,e,t)||0:gd(this,e,t)}});class bd extends wc{constructor(e,t){super(),this.namespace=e,this.tm=t}cmd(e,t){return this.tm.cmd(e,t,this.namespace)}event(e,t){return this.tm.event(e,t,this.namespace)}close(){return this.tm.namespaces.delete(this.namespace)}}var wd=class extends wc{constructor(e){super(),this.maxId=0,this.namespaces=new Map,this.transactions=new Map,this.transport=e,this.listener=t=>{let r;try{r=JSON.parse(t.utf8Data||t.data||t)}catch(e){return}switch(r.type){case"cmd":const t={name:r.name,data:r.data,namespace:r.namespace,accept:t=>{e.send(JSON.stringify({type:"response",transId:r.transId,data:t}))},reject:t=>{e.send(JSON.stringify({type:"error",transId:r.transId,data:t}))}};if(t.namespace){const e=this.namespaces.get(t.namespace);e?e.emit("cmd",t):this.emit("cmd",t)}else this.emit("cmd",t);break;case"response":{const e=this.transactions.get(r.transId);if(!e)return;this.transactions.delete(r.transId),e.resolve(r.data);break}case"error":{const e=this.transactions.get(r.transId);if(!e)return;this.transactions.delete(r.transId),e.reject(r.data);break}case"event":const i={name:r.name,data:r.data,namespace:r.namespace};if(i.namespace){var n=this.namespaces.get(i.namespace);n?n.emit("event",i):this.emit("event",i)}else this.emit("event",i)}},this.transport.addListener?this.transport.addListener("message",this.listener):this.transport.addEventListener("message",this.listener)}cmd(e,t,r){return new Promise(((n,i)=>{if(!e||0===e.length)throw new Error("Bad command name");const o={type:"cmd",transId:this.maxId++,name:e,data:t};r&&(o.namespace=r);const s=JSON.stringify(o);o.resolve=n,o.reject=i,this.transactions.set(o.transId,o);try{this.transport.send(s)}catch(e){throw this.transactions.delete(o.transId),e}}))}event(e,t,r){if(!e||0===e.length)throw new Error("Bad event name");const n={type:"event",name:e,data:t};r&&(n.namespace=r);const i=JSON.stringify(n);this.transport.send(i)}namespace(e){let t=this.namespaces.get(e);return t||(t=new bd(e,this),this.namespaces.set(e,t),t)}close(){for(const e of this.namespaces.values())e.close();this.transport.removeListener?this.transport.removeListener("message",this.listener):this.transport.removeEventListener("message",this.listener)}};const Sd=cn.get("Signaling"),Cd="wsConnectionSuccess",xd="wsConnectionError",Ed="wsConnectionClose",Id="broadcastEvent",Td={VP8:"vp8",VP9:"vp9",H264:"h264",AV1:"av1"},Rd={OPUS:"opus",MULTIOPUS:"multiopus"};class Pd extends wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{streamName:null,url:"ws://localhost:8080/"};super(),this.streamName=e.streamName,this.wsUrl=e.url,this.webSocket=null,this.transactionManager=null,this.serverId=null,this.clusterId=null}connect(){var e=this;return n((function*(){var t;return Sd.info("Connecting to Signaling Server"),e.transactionManager&&(null===(t=e.webSocket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?(Sd.info("Connected to server: ",e.webSocket.url),Sd.debug("WebSocket value: ",{url:e.webSocket.url,protocol:e.webSocket.protocol,readyState:e.webSocket.readyState,binaryType:e.webSocket.binaryType,extensions:e.webSocket.extensions}),e.emit(Cd,{ws:e.webSocket,tm:e.transactionManager}),e.webSocket):new Promise(((t,r)=>{e.webSocket=new WebSocket(e.wsUrl),e.transactionManager=new wd(e.webSocket),e.webSocket.onopen=()=>{Sd.info("WebSocket opened"),e.transactionManager.on("event",(t=>{e.emit(Id,t)})),Sd.info("Connected to server: ",e.webSocket.url),Sd.debug("WebSocket value: ",{url:e.webSocket.url,protocol:e.webSocket.protocol,readyState:e.webSocket.readyState,binaryType:e.webSocket.binaryType,extensions:e.webSocket.extensions}),e.emit(Cd,{ws:e.webSocket,tm:e.transactionManager}),t(e.webSocket)},e.webSocket.onerror=()=>{Sd.error("WebSocket not connected: ",e.webSocket.url),e.emit(xd,e.webSocket.url),r(e.webSocket.url)},e.webSocket.onclose=()=>{e.webSocket=null,e.transactionManager=null,Sd.info("Connection closed with Signaling Server."),e.emit(Ed)}}))}))()}close(){var e;Sd.info("Closing connection with Signaling Server."),null===(e=this.webSocket)||void 0===e||e.close()}subscribe(e,t){var r=arguments,i=this;return n((function*(){let n=r.length>2&&void 0!==r[2]?r[2]:null,o=r.length>3&&void 0!==r[3]?r[3]:null;Sd.info("Starting subscription to streamName: ",i.streamName),Sd.debug("Subcription local description: ",e);const s=Ad(t,n,o),a={sdp:e=pd.adaptCodecName(e,"AV1X",Td.AV1),streamId:i.streamName,pinnedSourceId:s.pinnedSourceId,excludedSourceIds:s.excludedSourceIds};s.vad&&(a.vad=!0),Array.isArray(s.events)&&(a.events=s.events);try{var c,u,l,d,f;yield i.connect(),Sd.info("Sending view command");const e=yield i.transactionManager.cmd("view",a),t=null===(c=(u=RTCRtpReceiver).getCapabilities)||void 0===c||null===(l=c.call(u,"video"))||void 0===l||null===(d=l.codecs)||void 0===d||null===(f=d.find)||void 0===f?void 0:f.call(d,(e=>"video/AV1X"===e.mimeType));return e.sdp=t?pd.adaptCodecName(e.sdp,Td.AV1,"AV1X"):e.sdp,Sd.info("Command sent, subscriberId: ",e.subscriberId),Sd.debug("Command result: ",e),i.serverId=e.subscriberId,i.clusterId=e.clusterId,e.sdp}catch(e){throw Sd.error("Error sending view command, error: ",e),e}}))()}publish(e,t){var r=arguments,i=this;return n((function*(){const n=kd(t,r.length>2&&void 0!==r[2]?r[2]:null,r.length>3&&void 0!==r[3]?r[3]:null);Sd.info("Starting publishing to streamName: ".concat(i.streamName,", codec: ").concat(n.codec)),Sd.debug("Publishing local description: ",e);const o=Object.values(Td);if(-1===o.indexOf(n.codec))throw Sd.error("Invalid codec. Possible values are: ",o),new Error("Invalid codec. Possible values are: ".concat(o));n.codec===Td.AV1&&(e=pd.adaptCodecName(e,"AV1X",Td.AV1));const s={name:i.streamName,sdp:e,codec:n.codec,sourceId:n.sourceId};null!==n.record&&(s.record=n.record),Array.isArray(n.events)&&(s.events=n.events);try{yield i.connect(),Sd.info("Sending publish command");const e=yield i.transactionManager.cmd("publish",s);if(n.codec===Td.AV1){var a,c,u,l,d;const t=null===(a=(c=RTCRtpSender).getCapabilities)||void 0===a||null===(u=a.call(c,"video"))||void 0===u||null===(l=u.codecs)||void 0===l||null===(d=l.find)||void 0===d?void 0:d.call(l,(e=>"video/AV1X"===e.mimeType));e.sdp=t?pd.adaptCodecName(e.sdp,Td.AV1,"AV1X"):e.sdp}return Sd.info("Command sent, publisherId: ",e.publisherId),Sd.debug("Command result: ",e),i.serverId=e.publisherId,i.clusterId=e.clusterId,e.sdp}catch(e){throw Sd.error("Error sending publish command, error: ",e),e}}))()}cmd(e,t){var r=this;return n((function*(){return Sd.info("Sending cmd: ".concat(e)),r.transactionManager.cmd(e,t)}))()}}const Ad=(e,t,r)=>{let n="object"==typeof e?e:{};return 0===Object.keys(n).length&&(n={vad:e,pinnedSourceId:t,excludedSourceIds:r}),n},kd=(e,t,r)=>{let n="object"==typeof e?e:{};if(0===Object.keys(n).length){const i=Td.H264;n={codec:null!=e?e:i,record:t,sourceId:r}}return n},Od=cn.get("PeerConnection"),Ld={track:"track",connectionStateChange:"connectionStateChange"},Dd={stereo:!1,mediaStream:null,codec:"h264",simulcast:!1,scalabilityMode:null,disableAudio:!1,disableVideo:!1,setSDPToPeer:!0};class Md extends wc{constructor(){super(),this.sessionDescription=null,this.peer=null,this.peerConnectionStats=null}createRTCPeer(){var e=arguments,t=this;return n((function*(){let r=e.length>0&&void 0!==e[0]?e[0]:null;Od.info("Creating new RTCPeerConnection"),Od.debug("RTC configuration provided by user: ",r),t.peer=Bd(t,r)}))()}getRTCPeer(){return Od.info("Getting RTC Peer"),this.peer}closeRTCPeer(){var e=this;return n((function*(){var t;Od.info("Closing RTCPeerConnection"),null===(t=e.peer)||void 0===t||t.close(),e.peer=null,e.stopStats(),e.emit(Ld.connectionStateChange,"closed")}))()}setRTCRemoteSDP(e){var t=this;return n((function*(){Od.info("Setting RTC Remote SDP");const r={type:"answer",sdp:e};try{yield t.peer.setRemoteDescription(r),Od.info("RTC Remote SDP was set successfully."),Od.debug("RTC Remote SDP new value: ",e)}catch(e){throw Od.error("Error while setting RTC Remote SDP: ",e),e}}))()}getRTCLocalSDP(){var e=arguments,r=this;return n((function*(){let n=e.length>0&&void 0!==e[0]?e[0]:Dd;Od.info("Getting RTC Local SDP"),n=t(t({},Dd),n),Od.debug("Options: ",n);const i=jd(n.mediaStream);i?Ud(r.peer,i,n):Fd(r.peer,n),Od.info("Creating peer offer");const o=yield r.peer.createOffer();return Od.info("Peer offer created"),Od.debug("Peer offer response: ",o.sdp),r.sessionDescription=o,n.disableAudio||(n.stereo&&(r.sessionDescription.sdp=pd.setStereo(r.sessionDescription.sdp)),n.dtx&&(r.sessionDescription.sdp=pd.setDTX(r.sessionDescription.sdp)),r.sessionDescription.sdp=pd.setMultiopus(r.sessionDescription.sdp,i)),!n.disableVideo&&n.simulcast&&(r.sessionDescription.sdp=pd.setSimulcast(r.sessionDescription.sdp,n.codec)),n.absCaptureTime&&(r.sessionDescription.sdp=pd.setAbsoluteCaptureTime(r.sessionDescription.sdp)),n.dependencyDescriptor&&(r.sessionDescription.sdp=pd.setDependencyDescriptor(r.sessionDescription.sdp)),n.setSDPToPeer&&(yield r.peer.setLocalDescription(r.sessionDescription),Od.info("Peer local description set")),r.sessionDescription.sdp}))()}addRemoteTrack(e,t){var r=this;return n((function*(){return new Promise(((n,i)=>{try{const i=r.peer.addTransceiver(e,{direction:"recvonly"});var o,s=c(t);try{for(s.s();!(o=s.n()).done;){o.value.addTrack(i.receiver.track)}}catch(e){s.e(e)}finally{s.f()}i.resolve=n,i.streams=t}catch(e){i(e)}}))}))()}updateBandwidthRestriction(e,t){return Od.info("Updating bandwidth restriction, bitrate value: ",t),Od.debug("SDP value: ",e),pd.setVideoBitrate(e,t)}updateBitrate(){var e=arguments,t=this;return n((function*(){let r=e.length>0&&void 0!==e[0]?e[0]:0;if(!t.peer)throw Od.error("Cannot update bitrate. No peer found."),new Error("Cannot update bitrate. No peer found.");Od.info("Updating bitrate to value: ",r),t.sessionDescription=yield t.peer.createOffer(),yield t.peer.setLocalDescription(t.sessionDescription);const n=t.updateBandwidthRestriction(t.peer.remoteDescription.sdp,r);yield t.setRTCRemoteSDP(n),Od.info("Bitrate restirctions updated: ","".concat(r>0?r:"unlimited"," kbps"))}))()}getRTCPeerStatus(){if(Od.info("Getting RTC peer status"),!this.peer)return null;const e=Vd(this.peer);return Od.info("RTC peer status getted, value: ",e),e}replaceTrack(e){if(!this.peer)return void Od.error("Could not change track if there is not an active connection.");const t=this.peer.getSenders().find((t=>t.track.kind===e.kind));t?t.replaceTrack(e):Od.error("There is no ".concat(e.kind," track in active broadcast."))}static getCapabilities(e){const r=new ad;if(r.isFirefox())return(e=>"video"===e?{codecs:[{codec:"vp8",mimeType:"video/VP8"},{codec:"vp9",mimeType:"video/VP9"},{codec:"h264",mimeType:"video/H264"}],headerExtensions:[]}:"audio"===e?{codecs:[{codec:"opus",mimeType:"audio/opus",channels:2}],headerExtensions:[]}:null)(e);const n=RTCRtpSender.getCapabilities(e);if(n){const s={};let a=new RegExp("^video/(".concat(Object.values(Td).join("|"),")x?$"),"i");"audio"===e&&(a=new RegExp("^audio/(".concat(Object.values(Rd).join("|"),")$"),"i"),r.isChrome()&&(s.multiopus={mimeType:"audio/multiopus",channels:6}));var i,o=c(n.codecs);try{for(o.s();!(i=o.n()).done;){const e=i.value,r=e.mimeType.match(a);if(r){const n=r[1].toLowerCase();if(s[n]=t(t({},s[n]),{},{mimeType:e.mimeType}),e.scalabilityModes){let t=s[n].scalabilityModes||[];t=[...t,...e.scalabilityModes],s[n].scalabilityModes=[...new Set(t)]}e.channels&&(s[n].channels=e.channels)}}}catch(e){o.e(e)}finally{o.f()}n.codecs=Object.keys(s).map((e=>t({codec:e},s[e])))}return n}getTracks(){var e,t;return null===(e=this.peer)||void 0===e||null===(t=e.getSenders())||void 0===t?void 0:t.map((e=>e.track))}initStats(){this.peerConnectionStats?Od.warn("Cannot init peer stats: Already initialized"):this.peer?(this.peerConnectionStats=new Gc(this.peer),this.peerConnectionStats.init(),Lc(this.peerConnectionStats,this,[$c])):Od.warn("Cannot init peer stats: RTCPeerConnection not initialized")}stopStats(){var e;null===(e=this.peerConnectionStats)||void 0===e||e.stop(),this.peerConnectionStats=null}}const Nd=e=>(null==e?void 0:e.getAudioTracks().length)<=1&&(null==e?void 0:e.getVideoTracks().length)<=1,jd=e=>{if(!e)return null;if(e instanceof MediaStream&&Nd(e))return e;if(!(e instanceof MediaStream)){Od.info("Creating MediaStream to add received tracks.");const n=new MediaStream;var t,r=c(e);try{for(r.s();!(t=r.n()).done;){const e=t.value;n.addTrack(e)}}catch(e){r.e(e)}finally{r.f()}if(Nd(n))return n}throw Od.error("MediaStream must have 1 audio track and 1 video track, or at least one of them."),new Error("MediaStream must have 1 audio track and 1 video track, or at least one of them.")},Bd=(e,t)=>{const r=new RTCPeerConnection(t);return _d(e,r),r},_d=(e,t)=>{var r;t.ontrack=t=>{var r;if(Od.info("New track from peer."),Od.debug("Track event value: ",t),null!=t&&null!==(r=t.transceiver)&&void 0!==r&&r.resolve){const e=t.transceiver.resolve;delete t.transceiver.resolve,e(t.transceiver)}e.emit(Ld.track,t)},t.connectionState?t.onconnectionstatechange=r=>{Od.info("Peer connection state change: ",t.connectionState),e.emit(Ld.connectionStateChange,t.connectionState)}:t.oniceconnectionstatechange=r=>{Od.info("Peer ICE connection state change: ",t.iceConnectionState),e.emit(Ld.connectionStateChange,t.iceConnectionState)},t.onnegotiationneeded=(r=n((function*(e){if(!t.remoteDescription)return;Od.info("Peer onnegotiationneeded, updating local description");const r=yield t.createOffer();Od.info("Peer onnegotiationneeded, got local offer",r.sdp),r.sdp=pd.updateMissingVideoExtensions(r.sdp,t.remoteDescription.sdp),yield t.setLocalDescription(r);const n=pd.renegotiate(r.sdp,t.remoteDescription.sdp);Od.info("Peer onnegotiationneeded, updating remote description",n),yield t.setRemoteDescription({type:"answer",sdp:n}),Od.info("Peer onnegotiationneeded, renegotiation done")})),function(e){return r.apply(this,arguments)})},Ud=(e,t,r)=>{Od.info("Adding mediaStream tracks to RTCPeerConnection");var n,i=c(t.getTracks());try{for(i.s();!(n=i.n()).done;){const i=n.value,o={streams:[t]};"audio"===i.kind&&(o.direction=r.disableAudio?"inactive":"sendonly"),"video"===i.kind&&(o.direction=r.disableVideo?"inactive":"sendonly",r.scalabilityMode&&(new ad).isChrome()?(Od.debug("Video track with scalability mode: ".concat(r.scalabilityMode,".")),o.sendEncodings=[{scalabilityMode:r.scalabilityMode}]):r.scalabilityMode&&Od.warn("SVC is only supported in Google Chrome")),e.addTransceiver(i,o),Od.info("Track '".concat(i.label,"' added: "),"id: ".concat(i.id),"kind: ".concat(i.kind))}}catch(e){i.e(e)}finally{i.f()}},Fd=(e,t)=>{t.disableVideo||e.addTransceiver("video",{direction:"recvonly"}),t.disableAudio||e.addTransceiver("audio",{direction:"recvonly"});for(let r=0;r<t.multiplexedAudioTracks;r++)e.addTransceiver("audio",{direction:"recvonly"})},Vd=e=>{var t;const r=null!==(t=e.connectionState)&&void 0!==t?t:e.iceConnectionState;switch(r){case"checking":return"connecting";case"completed":return"connected";default:return r}},zd=cn.get("Director"),$d="WebRtc";let Gd="";let qd="https://director.millicast.com";class Wd{static setEndpoint(e){qd=e.replace(/\/$/,"")}static getEndpoint(){return qd}static setLiveDomain(e){Gd=e.replace(/\/$/,"")}static getLiveDomain(){return Gd}static getPublisher(e){var t=arguments,r=this;return n((function*(){const n=Xd(e,t.length>1&&void 0!==t[1]?t[1]:null,t.length>2&&void 0!==t[2]?t[2]:$d);zd.info("Getting publisher connection path for stream name: ",n.streamName);const i={streamName:n.streamName,streamType:n.streamType},o={"Content-Type":"application/json",Authorization:"Bearer ".concat(n.token)},s="".concat(r.getEndpoint(),"/api/director/publish");try{let e=yield fetch(s,{method:"POST",headers:o,body:JSON.stringify(i)});if(e=yield e.json(),"fail"===e.status){throw new Error(e.data.message)}return e=Yd(e),zd.debug("Getting publisher response: ",e),e.data}catch(e){throw zd.error("Error while getting publisher connection path. ",e),e}}))()}static getSubscriber(e){var r=arguments,i=this;return n((function*(){const n=Hd(e,r.length>1&&void 0!==r[1]?r[1]:null,r.length>2&&void 0!==r[2]?r[2]:null);zd.info("Getting subscriber connection data for stream name: ".concat(n.streamName," and account id: ").concat(n.streamAccountId));const o={streamAccountId:n.streamAccountId,streamName:n.streamName};let s={"Content-Type":"application/json"};n.subscriberToken&&(s=t(t({},s),{},{Authorization:"Bearer ".concat(n.subscriberToken)}));const a="".concat(i.getEndpoint(),"/api/director/subscribe");try{let e=yield fetch(a,{method:"POST",headers:s,body:JSON.stringify(o)});if(e=yield e.json(),"fail"===e.status){throw new Error(e.data.message)}return e=Yd(e),zd.debug("Getting subscriber response: ",e),e.data}catch(e){throw zd.error("Error while getting subscriber connection path. ",e),e}}))()}}const Xd=(e,t,r)=>{let n="object"==typeof e?e:{};return 0===Object.keys(n).length&&(n={token:e,streamName:t,streamType:r}),n},Hd=(e,t,r)=>{let n="object"==typeof e?e:{};return 0===Object.keys(n).length&&(n={streamName:e,streamAccountId:t,subscriberToken:r}),n},Yd=e=>{if(Wd.getLiveDomain()){const t=/\/\/(.*?)\//,r=e.data.urls.map((e=>{const r=t.exec(e);return e.replace(r[1],Wd.getLiveDomain())}));e.data.urls=r}return e};function Jd(e){this.message=e}Jd.prototype=new Error,Jd.prototype.name="InvalidCharacterError";var Kd="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Jd("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,i=0,o=0,s="";n=t.charAt(o++);~n&&(r=i%4?64*r+n:n,i++%4)?s+=String.fromCharCode(255&r>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return s};function Zd(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Kd(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Kd(t)}}function Qd(e){this.message=e}Qd.prototype=new Error,Qd.prototype.name="InvalidTokenError";var ef=l((function(e,t){!function(r){if(null!=t&&"number"!=typeof t.nodeType)e.exports=r();else{var n=r(),i="undefined"!=typeof self?self:$.global;"function"!=typeof i.btoa&&(i.btoa=n.btoa),"function"!=typeof i.atob&&(i.atob=n.atob)}}((function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function t(e){this.message=e}return t.prototype=new Error,t.prototype.name="InvalidCharacterError",{btoa:function(r){for(var n,i,o=String(r),s=0,a=e,c="";o.charAt(0|s)||(a="=",s%1);c+=a.charAt(63&n>>8-s%1*8)){if((i=o.charCodeAt(s+=3/4))>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|i}return c},atob:function(r){var n=String(r).replace(/[=]+$/,"");if(n.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,o,s=0,a=0,c="";o=n.charAt(a++);~o&&(i=s%4?64*i+o:o,s++%4)?c+=String.fromCharCode(255&i>>(-2*s&6)):0)o=e.indexOf(o);return c}}}))}));let tf;class rf extends wc{constructor(e,t,r,n){if(super(),tf=r,!e)throw tf.error("Stream Name is required to construct this module."),new Error("Stream Name is required to construct this module.");if(!t)throw tf.error("Token generator is required to construct this module."),new Error("Token generator is required to construct this module.");this.webRTCPeer=new Md,this.signaling=null,this.streamName=e,this.autoReconnect=n,this.reconnectionInterval=1e3,this.alreadyDisconnected=!1,this.firstReconnection=!0,this.tokenGenerator=t,this.options=null}getRTCPeerConnection(){return this.webRTCPeer?this.webRTCPeer.getRTCPeer():null}stop(){var e;tf.info("Stopping"),this.webRTCPeer.closeRTCPeer(),null===(e=this.signaling)||void 0===e||e.close(),this.signaling=null,this.webRTCPeer=new Md}isActive(){const e=this.webRTCPeer.getRTCPeerStatus();return tf.info("Broadcast status: ",e||"not_established"),"connected"===e}setReconnect(){this.signaling.on("migrate",(()=>this.replaceConnection())),this.autoReconnect&&(this.signaling.on(xd,(()=>{!this.firstReconnection&&this.alreadyDisconnected||(this.firstReconnection=!1,this.reconnect())})),this.webRTCPeer.on(Ld.connectionStateChange,(e=>{("failed"===e||"disconnected"===e&&this.alreadyDisconnected)&&this.firstReconnection?(this.firstReconnection=!1,this.reconnect()):"disconnected"===e?(this.alreadyDisconnected=!0,setTimeout((()=>this.reconnect()),1500)):this.alreadyDisconnected=!1})))}reconnect(){var e=this;return n((function*(){try{e.isActive()||(e.stop(),yield e.connect(e.options),e.alreadyDisconnected=!1,e.reconnectionInterval=1e3,e.firstReconnection=!0)}catch(t){e.reconnectionInterval=nf(e.reconnectionInterval),tf.error("Reconnection failed, retrying in ".concat(e.reconnectionInterval,"ms. "),t),e.emit("reconnect",{timeout:e.reconnectionInterval,error:t}),setTimeout((()=>e.reconnect()),e.reconnectionInterval)}}))()}}const nf=e=>e<32e3?2*e:e,of=cn.get("Publish"),sf={mediaStream:null,bandwidth:0,disableVideo:!1,disableAudio:!1,codec:Td.H264,simulcast:!1,scalabilityMode:null,peerConfig:{}};class af extends rf{constructor(e,t){super(e,t,of,!(arguments.length>2&&void 0!==arguments[2])||arguments[2])}connect(){var e=arguments,r=this;return n((function*(){let n=e.length>0&&void 0!==e[0]?e[0]:sf;r.options=t(t(t({},sf),n),{},{setSDPToPeer:!1}),yield r.initConnection({migrate:!1})}))()}reconnect(){var e,t;this.options.mediaStream=null!==(e=null===(t=this.webRTCPeer)||void 0===t?void 0:t.getTracks())&&void 0!==e?e:this.options.mediaStream,super.reconnect()}replaceConnection(){var e=this;return n((function*(){var t,r;of.info("Migrating current connection"),e.options.mediaStream=null!==(t=null===(r=e.webRTCPeer)||void 0===r?void 0:r.getTracks())&&void 0!==t?t:e.options.mediaStream,yield e.initConnection({migrate:!0})}))()}record(){var e=this;return n((function*(){var t;e.recordingAvailable?(e.options.record=!0,yield null===(t=e.signaling)||void 0===t?void 0:t.cmd("record"),of.info("Broadcaster start recording")):of.error("Record not available")}))()}unrecord(){var e=this;return n((function*(){var t;e.recordingAvailable?(e.options.record=!1,yield null===(t=e.signaling)||void 0===t?void 0:t.cmd("unrecord"),of.info("Broadcaster stop recording")):of.error("Unrecord not available")}))()}initConnection(e){var t=this;return n((function*(){var r,n;let i,o;if(of.debug("Broadcast option values: ",t.options),!t.options.mediaStream)throw of.error("Error while broadcasting. MediaStream required"),new Error("MediaStream required");if(!e.migrate&&t.isActive())throw of.warn("Broadcast currently working"),new Error("Broadcast currently working");try{var s;o=yield t.tokenGenerator(),t.options.peerConfig.iceServers=null===(s=o)||void 0===s?void 0:s.iceServers}catch(e){throw of.error("Error generating token."),e}if(!o)throw of.error("Error while broadcasting. Publisher data required"),new Error("Publisher data required");if(t.recordingAvailable=function(e,t){if("string"!=typeof e)throw new Qd("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Zd(e.split(".")[r]))}catch(e){throw new Qd("Invalid token specified: "+e.message)}}(o.jwt)[ef.atob("bWlsbGljYXN0")].record,t.options.record&&!t.recordingAvailable)throw of.error("Error while broadcasting. Record option detected but recording is not available"),new Error("Record option detected but recording is not available");const a=new Pd({streamName:t.streamName,url:"".concat(o.urls[0],"?token=").concat(o.jwt)}),c=e.migrate?new Md:t.webRTCPeer;yield c.createRTCPeer(t.options.peerConfig),null===(r=t.stopReemitingWebRTCPeerInstanceEvents)||void 0===r||r.call(t),null===(n=t.stopReemitingSignalingInstanceEvents)||void 0===n||n.call(t),t.stopReemitingWebRTCPeerInstanceEvents=Lc(c,t,[Ld.connectionStateChange]),t.stopReemitingSignalingInstanceEvents=Lc(a,t,[Id]);const u=c.getRTCLocalSDP(t.options),l=a.connect();i=yield Promise.all([u,l]);const d=i[0];let f=t.signaling;t.signaling=a;const p=t.signaling.publish(d,t.options),h=c.peer.setLocalDescription(c.sessionDescription);i=yield Promise.all([p,h]);let g=i[0];!t.options.disableVideo&&t.options.bandwidth>0&&(g=c.updateBandwidthRestriction(g,t.options.bandwidth)),yield c.setRTCRemoteSDP(g),of.info("Broadcasting to streamName: ",t.streamName);let m=t.webRTCPeer;t.webRTCPeer=c,t.setReconnect(),e.migrate&&t.webRTCPeer.on(Ld.connectionStateChange,(e=>{var t,r,n,i;["connected","disconnected","failed","closed"].includes(e)&&(null===(t=f)||void 0===t||null===(r=t.close)||void 0===r||r.call(t),null===(n=m)||void 0===n||null===(i=n.closeRTCPeer)||void 0===i||i.call(n),f=m=null)}))}))()}}const cf=cn.get("View"),uf={disableVideo:!1,disableAudio:!1,peerConfig:{}};class lf extends rf{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e,t,cf,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),r&&this.on(Ld.track,(e=>{r.srcObject=e.streams[0]}))}connect(){var e=arguments,r=this;return n((function*(){let n=e.length>0&&void 0!==e[0]?e[0]:uf;r.options=t(t(t({},uf),n),{},{setSDPToPeer:!1}),yield r.initConnection({migrate:!1})}))()}select(){var e=arguments,t=this;return n((function*(){let r=e.length>0&&void 0!==e[0]?e[0]:{};cf.debug("Viewer select layer values: ",r),yield t.signaling.cmd("select",{layer:r}),cf.info("Connected to streamName: ",t.streamName)}))()}addRemoteTrack(e,t){var r=this;return n((function*(){return cf.info("Viewer adding remote % track",e),r.webRTCPeer.addRemoteTrack(e,t)}))()}project(e,t){var r=this;return n((function*(){var n,i=c(t);try{for(i.s();!(n=i.n()).done;){const e=n.value;if(!e.trackId&&!e.media)throw cf.error("Error in projection mapping, trackId or mediaId must be set"),new Error("Error in projection mapping, trackId or mediaId must be set");const t=r.webRTCPeer.getRTCPeer();if(e.mediaId&&!t.getTransceivers().find((t=>t.mid===e.mediaId)))throw cf.error("Error in projection mapping, ".concat(e.mediaId," mid not found in local transceivers")),new Error("Error in projection mapping, ".concat(e.mediaId," mid not found in local transceivers"))}}catch(e){i.e(e)}finally{i.f()}cf.debug("Viewer project source:%s layer mappings: ",e,t),yield r.signaling.cmd("project",{sourceId:e,mapping:t}),cf.info("Projection done")}))()}unproject(e){var t=this;return n((function*(){cf.debug("Viewer unproject mediaIds: ",e),yield t.signaling.cmd("unproject",{mediaIds:e}),cf.info("Unprojection done")}))()}replaceConnection(){var e=this;return n((function*(){cf.info("Migrating current connection"),yield e.initConnection({migrate:!0})}))()}initConnection(e){var r=this;return n((function*(){var n,i;let o,s;if(cf.debug("Viewer connect options values: ",r.options),!e.migrate&&r.isActive())throw cf.warn("Viewer currently subscribed"),new Error("Viewer currently subscribed");try{var a;s=yield r.tokenGenerator(),r.options.peerConfig.iceServers=null===(a=s)||void 0===a?void 0:a.iceServers}catch(e){throw cf.error("Error generating token."),e}if(!s)throw cf.error("Error while subscribing. Subscriber data required"),new Error("Subscriber data required");const c=new Pd({streamName:r.streamName,url:"".concat(s.urls[0],"?token=").concat(s.jwt)}),u=e.migrate?new Md:r.webRTCPeer;yield u.createRTCPeer(r.options.peerConfig),null===(n=r.stopReemitingWebRTCPeerInstanceEvents)||void 0===n||n.call(r),null===(i=r.stopReemitingSignalingInstanceEvents)||void 0===i||i.call(r),r.stopReemitingWebRTCPeerInstanceEvents=Lc(u,r,Object.values(Ld)),r.stopReemitingSignalingInstanceEvents=Lc(c,r,[Id]);const l=u.getRTCLocalSDP(t(t({},r.options),{},{stereo:!0})),d=c.connect();o=yield Promise.all([l,d]);const f=o[0];let p=r.signaling;r.signaling=c;const h=r.signaling.subscribe(f,t(t({},r.options),{},{vad:r.options.multiplexedAudioTracks>0})),g=u.peer.setLocalDescription(u.sessionDescription);o=yield Promise.all([h,g]);const m=o[0];yield u.setRTCRemoteSDP(m),cf.info("Connected to streamName: ",r.streamName);let v=r.webRTCPeer;r.webRTCPeer=u,r.setReconnect(),e.migrate&&r.webRTCPeer.on(Ld.connectionStateChange,(e=>{if("connected"===e)setTimeout((()=>{var e,t,r,n;null===(e=p)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),null===(r=v)||void 0===r||null===(n=r.closeRTCPeer)||void 0===n||n.call(r),p=v=null,cf.info("Current connection migrated")}),1e3);else if(["disconnected","failed","closed"].includes(e)){var t,r,n,i;null===(t=p)||void 0===t||null===(r=t.close)||void 0===r||r.call(t),null===(n=v)||void 0===n||null===(i=n.closeRTCPeer)||void 0===i||i.call(n),p=v=null}}))}))()}}export{Wd as Director,cn as Logger,Md as PeerConnection,af as Publish,Pd as Signaling,lf as View};
